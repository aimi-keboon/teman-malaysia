<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Custom Activities - Teman Malaysia</title>
    <meta
      name="description"
      content="Book personalized companionship for leisure activities, social outings, and recreational pursuits with Teman Malaysia."
    />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/images/favicon.png">
    <link rel="apple-touch-icon" href="../assets/images/apple-touch-icon.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Include Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

    <style>
      /* Reset and base styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
        color: #374151;
        background: #f9fafb;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* Header Styles */
      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
        transition: all 0.3s ease;
      }

      .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
      }

      .nav__logo {
        height: 40px;
        width: auto;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .btn--primary {
        background: #f59e0b;
        color: white;
      }

      .btn--primary:hover {
        background: #d97706;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      }

      .btn--outline {
        background: transparent;
        color: #f59e0b;
        border: 2px solid #f59e0b;
      }

      .btn--outline:hover {
        background: #f59e0b;
        color: white;
        transform: translateY(-2px);
      }

      .btn--large {
        padding: 16px 32px;
        font-size: 16px;
      }

      .btn--success {
        background: #16a34a;
        color: white;
        font-weight: 600;
      }

      .btn--success:hover {
        background: #15803d;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
      }

      /* Main Section */
      .booking-section {
        padding: 120px 0 80px 0;
        min-height: 100vh;
      }

      .booking__header {
        text-align: center;
        margin-bottom: 60px;
      }

      .booking__title {
        font-size: 3rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 16px;
      }

      .booking__subtitle {
        font-size: 1.25rem;
        color: #6b7280;
        max-width: 600px;
        margin: 0 auto;
      }

      .service-info-card {
        background: white;
        border-radius: 16px;
        padding: 32px;
        margin: 0 auto 40px auto;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 2px solid #e5f3ff;
        max-width: 800px;
      }

      .service-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
      }

      .service-icon {
        width: 60px;
        height: 60px;
        background: #f59e0b;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .service-icon i {
        font-size: 24px;
        color: white;
      }

      .service-header h2 {
        font-size: 1.75rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
      }

      .service-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-top: 24px;
      }

      .feature-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #4b5563;
      }

      .feature-item i {
        color: #10b981;
        font-size: 12px;
      }

      /* Progress Steps */
      .progress-steps {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 40px 0 60px 0;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        gap: 80px;
      }

      .step {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .step__number {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 18px;
        background: #e5e7eb;
        color: #6b7280;
        border: 3px solid #e5e7eb;
        transition: all 0.3s ease;
        margin-bottom: 12px;
      }

      .step.active .step__number {
        background: #f59e0b;
        color: white;
        border-color: #f59e0b;
        box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.1);
      }

      .step.completed .step__number {
        background: #10b981;
        color: white;
        border-color: #10b981;
      }

      .step__label {
        font-size: 14px;
        font-weight: 500;
        color: #6b7280;
        text-align: center;
        transition: color 0.3s ease;
        white-space: nowrap;
      }

      .step.active .step__label {
        color: #f59e0b;
        font-weight: 600;
      }

      .step.completed .step__label {
        color: #10b981;
        font-weight: 600;
      }

      /* Form Container */
      .booking__container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        overflow: hidden;
      }

      /* Form Styles */
      .booking-form {
        padding: 40px;
      }

      .form-step {
        display: none;
      }

      .form-step.active {
        display: block;
      }

      .step-title {
        font-size: 2rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 32px;
        text-align: center;
      }

      /* Package Selection */
      .package-options {
        display: grid;
        gap: 20px;
        margin-bottom: 40px;
      }

      .package-option {
        position: relative;
      }

      .package-option input[type="radio"] {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .package-card {
        display: block;
        padding: 24px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
      }

      .package-card:hover {
        border-color: #f59e0b;
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.1);
      }

      .package-option input[type="radio"]:checked + .package-card {
        border-color: #f59e0b;
        background: #fffbeb;
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.1);
      }

      .package-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .package-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
      }

      .package-price {
        font-size: 1.5rem;
        font-weight: 700;
        color: #f59e0b;
      }

      .package-description {
        color: #6b7280;
        margin-bottom: 16px;
      }

      .hours-selection {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
      }

      .package-notes {
        margin-top: 16px;
        padding: 12px;
        background: #f9fafb;
        border-radius: 6px;
      }

      .package-notes small {
        display: block;
        color: #6b7280;
        margin-bottom: 4px;
      }

      /* Form Sections */
      .form-section {
        margin-bottom: 40px;
        padding: 24px;
        background: #f9fafb;
        border-radius: 12px;
      }

      .form-section-title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 24px;
      }

      .form-section-title i {
        color: #f59e0b;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        margin-top: 10px;
      }

      .form-label {
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .form-input,
      .form-select,
      .form-textarea {
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: #f59e0b;
        box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
      }

      .form-help {
        font-size: 12px;
        color: #6b7280;
        margin-top: 4px;
      }

      /* Radio and Checkbox Options */
      .radio-option,
      .checkbox-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 12px;
      }

      .radio-option:hover,
      .checkbox-item:hover {
        border-color: #f59e0b;
      }

      .radio-option input[type="radio"],
      .checkbox-item input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .radio-custom,
      .checkmark {
        width: 20px;
        height: 20px;
        border: 2px solid #d1d5db;
        position: relative;
        flex-shrink: 0;
        transition: all 0.3s ease;
      }

      .radio-custom {
        border-radius: 50%;
      }

      .checkmark {
        border-radius: 4px;
      }

      .radio-option:hover .radio-custom,
      .checkbox-item:hover .checkmark {
        border-color: #f59e0b;
      }

      .radio-option input[type="radio"]:checked ~ .radio-custom {
        border-color: #f59e0b;
      }

      .radio-option input[type="radio"]:checked ~ .radio-custom::after {
        content: "";
        width: 8px;
        height: 8px;
        background: #f59e0b;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .checkbox-item input[type="checkbox"]:checked ~ .checkmark {
        background: #f59e0b;
        border-color: #f59e0b;
      }

      .checkbox-item input[type="checkbox"]:checked ~ .checkmark::after {
        content: "✓";
        color: white;
        font-size: 12px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .radio-content strong {
        display: block;
        margin-bottom: 4px;
        color: #1f2937;
      }

      .radio-content p {
        font-size: 14px;
        color: #6b7280;
        margin: 0;
      }

      /* Fixed checkbox styling */
      .terms-checkbox {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        cursor: pointer;
        margin-bottom: 32px;
      }

      .terms-checkbox input[type="checkbox"] {
        opacity: 0;
        position: absolute;
        pointer-events: none;
      }

      .terms-checkbox .checkmark {
        width: 20px;
        height: 20px;
        border: 2px solid #d1d5db;
        border-radius: 4px;
        position: relative;
        flex-shrink: 0;
        transition: all 0.3s ease;
        margin-top: 2px;
      }

      .terms-checkbox:hover .checkmark {
        border-color: #f59e0b;
      }

      .terms-checkbox input[type="checkbox"]:checked ~ .checkmark {
        background: #f59e0b;
        border-color: #f59e0b;
      }

      .terms-checkbox input[type="checkbox"]:checked ~ .checkmark::after {
        content: "✓";
        color: white;
        font-size: 12px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .terms-text {
        font-size: 14px;
        color: #374151;
      }

      .terms-text a {
        color: #f59e0b;
        text-decoration: none;
      }

      .terms-text a:hover {
        text-decoration: underline;
      }

      /* Summary Styles */
      .booking-summary {
        display: grid;
        gap: 24px;
        margin-bottom: 32px;
      }

      .summary-card {
        background: #f9fafb;
        border-radius: 12px;
        padding: 24px;
        border: 1px solid #e5e7eb;
      }

      .summary-card h3 {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #1f2937;
        margin-bottom: 20px;
        font-size: 1.25rem;
        font-weight: 600;
      }

      .summary-card h3 i {
        color: #f59e0b;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e5e7eb;
      }

      .summary-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .summary-label {
        font-weight: 500;
        color: #6b7280;
        flex: 0 0 40%;
      }

      .summary-value {
        color: #1f2937;
        text-align: right;
        flex: 1;
        word-break: break-word;
      }

      .summary-item.total {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 2px solid #f59e0b;
        font-size: 1.125rem;
        font-weight: 600;
      }

      .summary-item.total .summary-label {
        color: #1f2937;
      }

      .summary-item.total .summary-value {
        color: #f59e0b;
        font-size: 1.25rem;
      }

      .cost-note {
        font-size: 12px;
        color: #6b7280;
        margin-top: 8px;
        font-style: italic;
      }

      /* Form Actions */
      .form-actions {
        display: flex;
        justify-content: space-between;
        gap: 16px;
        margin-top: 40px;
      }

      /* Back Link */
      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: #6b7280;
        text-decoration: none;
        margin-bottom: 24px;
        font-size: 14px;
        transition: color 0.3s ease;
      }

      .back-link:hover {
        color: #f59e0b;
      }

      /* Error styling */
      .error {
        border-color: #ef4444 !important;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
      }

      .error-message {
        color: #ef4444;
        font-size: 12px;
        margin-top: 4px;
      }

      /* Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal-content {
        background: white;
        border-radius: 16px;
        padding: 40px;
        max-width: 500px;
        text-align: center;
        margin: 20px;
      }

      .success-icon {
        font-size: 4rem;
        color: #10b981;
        margin-bottom: 20px;
      }

      .modal-content h2 {
        color: #1f2937;
        margin-bottom: 16px;
      }

      .booking-reference {
        background: #f3f4f6;
        padding: 16px;
        border-radius: 8px;
        margin: 20px 0;
      }

      .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 24px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .booking__title {
          font-size: 2rem;
        }

        .booking-form {
          padding: 24px;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .form-actions {
          flex-direction: column;
        }

        .service-header {
          flex-direction: column;
          text-align: center;
          align-items: center;
        }

        .service-icon {
          margin-bottom: 16px;
        }

        .progress-steps {
          margin: 30px 0 40px 0;
          gap: 40px;
        }

        .step__number {
          width: 40px;
          height: 40px;
          font-size: 16px;
        }

        .step__label {
          font-size: 12px;
        }

        .package-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }
      }

      .text-center {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- Header Component -->
    <div id="header-placeholder"></div>

    <!-- Booking Section -->
    <section class="booking-section">
      <div class="container">
        <a href="booking.html" class="back-link">
          <i class="fas fa-arrow-left"></i>
          Back to Services
        </a>

        <div class="booking__header text-center">
          <h1 class="booking__title">Custom Activities Companion</h1>
          <p class="booking__subtitle">
            Personalized companionship for leisure activities, social outings, and recreational pursuits
          </p>
        </div>

        <!-- Service Information Card -->
        <div class="service-info-card">
          <div class="service-header">
            <div class="service-icon">
              <i class="fas fa-users"></i>
            </div>
            <h2>TEMAN Customised Activities</h2>
          </div>
          <p>Enjoy personalized companionship for any leisure activity or social outing. Our friendly Temanions will accompany you to create memorable experiences while ensuring your safety and comfort throughout your chosen activities.</p>
          
          <div class="service-features">
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Shopping & errands
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Park visits & nature walks
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Dining & cafe visits
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Art galleries & museums
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Concerts & shows
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Recreational activities
            </div>
          </div>
        </div>

        <div class="booking__container">
          <!-- Progress Steps -->
          <div class="progress-steps" id="progressSteps">
            <div class="step active" data-step="1">
              <div class="step__number">1</div>
              <div class="step__label">Package</div>
            </div>
            <div class="step" data-step="2">
              <div class="step__number">2</div>
              <div class="step__label">Details</div>
            </div>
            <div class="step" data-step="3">
              <div class="step__number">3</div>
              <div class="step__label">Confirm</div>
            </div>
          </div>

          <!-- Booking Form -->
          <form id="custom-activities-booking-form" class="booking-form" data-form-type="custom-activities">
            <!-- Step 1: Package Selection -->
            <div class="form-step active" data-step="1">
              <h2 class="step-title">Choose Your Package</h2>

              <div class="package-options">
                <div class="package-option">
                  <input
                    type="radio"
                    name="package"
                    value="hourly"
                    id="hourly-package"
                    required
                  />
                  <label for="hourly-package" class="package-card">
                    <div class="package-header">
                      <div class="package-title">Hourly Rate</div>
                      <div class="package-price">RM35/hour</div>
                    </div>
                    <div class="package-description">
                      Flexible hourly booking for any leisure activities or social outings. Minimum 2 hours required.
                    </div>
                    
                    <div class="hours-selection" style="display: none">
                      <label for="hours" class="form-label">Number of Hours: *</label>
                      <select name="hours" id="hours" class="form-select">
                        <option value="">Select hours</option>
                        <option value="2">2 hours - RM70</option>
                        <option value="3">3 hours - RM105</option>
                        <option value="4">4 hours - RM140</option>
                        <option value="5">5 hours - RM175</option>
                        <option value="6">6 hours - RM210</option>
                        <option value="" disabled>More than 6 hours (Contact us)</option>
                      </select>
                    </div>
                    
                    <div class="package-notes">
                      <small>• Perfect for any leisure or social activities</small>
                      <small>• Completely customizable to your interests</small>
                      <small>• Flexible scheduling available</small>
                    </div>
                  </label>
                </div>
              </div>

              <div style="background: #fffbeb; padding: 16px; border-radius: 8px; margin-bottom: 32px; border-left: 4px solid #f59e0b;">
                <h4 style="color: #d97706; margin-bottom: 8px;">Additional Fees & Information:</h4>
                <small style="display: block; color: #d97706; margin-bottom: 4px;">• Transportation fee: RM0.80/KM or e-hailing fare</small>
                <small style="display: block; color: #d97706; margin-bottom: 4px;">• Transport allowance: RM20/session</small>
                <small style="display: block; color: #d97706; margin-bottom: 4px;">• Surcharge: RM37/hour for Public Holiday/Sunday/last minute booking</small>
                <small style="display: block; color: #d97706;">• For service longer than 6 hours, bulk purchase or customization - contact us for quote</small>
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn--primary btn--large"
                  onclick="nextStep()"
                >
                  Continue to Details
                  <i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>

            <!-- Step 2: Personal Details -->
            <div class="form-step" data-step="2">
              <h2 class="step-title">Activity Details & Information</h2>

              <!-- Contact Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-user"></i>
                  Contact Information
                </h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="full-name" class="form-label">Full Name *</label>
                    <input
                      type="text"
                      id="full-name"
                      name="full_name"
                      class="form-input"
                      placeholder="Enter your full name"
                      required
                    />
                  </div>

                  <div class="form-group">
                    <label for="relationship" class="form-label">Relationship to Care Recipient</label>
                    <select id="relationship" name="relationship" class="form-select">
                      <option value="">Select relationship</option>
                      <option value="self">Self</option>
                      <option value="spouse">Spouse</option>
                      <option value="child">Son/Daughter</option>
                      <option value="parent">Parent</option>
                      <option value="sibling">Brother/Sister</option>
                      <option value="relative">Other Relative</option>
                      <option value="caregiver">Professional Caregiver</option>
                      <option value="friend">Friend</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="phone" class="form-label">Phone Number *</label>
                    <input
                      type="tel"
                      id="phone"
                      name="phone"
                      class="form-input"
                      placeholder="+60 11-234 5678"
                      required
                    />
                  </div>

                  <div class="form-group">
                    <label for="email" class="form-label">Email Address *</label>
                    <input
                      type="email"
                      id="email"
                      name="email"
                      class="form-input"
                      placeholder="your.email@example.com"
                      required
                    />
                    <small class="form-help">Use company email if claiming staff benefit</small>
                  </div>

                  <div class="form-group">
                    <label for="employer" class="form-label">Employer Name</label>
                    <input
                      type="text"
                      id="employer"
                      name="employer"
                      class="form-input"
                      placeholder="Company name"
                    />
                    <small class="form-help">For those claiming for Staff Benefit only</small>
                  </div>

                  <div class="form-group">
                    <label for="staff_id" class="form-label">Staff ID</label>
                    <input
                      type="text"
                      id="staff_id"
                      name="staff_id"
                      class="form-input"
                      placeholder="Employee ID"
                    />
                    <small class="form-help">For those claiming for Staff Benefit only</small>
                  </div>
                </div>

                <div class="form-group">
                  <label for="emergency-contact" class="form-label">Emergency Contact Person *</label>
                  <input
                    type="text"
                    id="emergency-contact"
                    name="emergency_contact"
                    class="form-input"
                    placeholder="Name and phone number of emergency contact"
                    required
                  />
                </div>
              </div>

              <!-- Care Recipient Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-heart-pulse"></i>
                  Care Recipient Information
                </h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="participant-name" class="form-label">Care Recipient Name</label>
                    <input
                      type="text"
                      id="participant-name"
                      name="participant_name"
                      class="form-input"
                      placeholder="If different from contact person"
                    />
                  </div>

                  <div class="form-group">
                    <label for="participant-age" class="form-label">Age</label>
                    <input
                      type="number"
                      id="participant-age"
                      name="participant_age"
                      class="form-input"
                      min="1"
                      max="120"
                      placeholder="Age in years"
                    />
                  </div>

                  <div class="form-group">
                    <label for="participant-gender" class="form-label">Gender</label>
                    <select id="participant-gender" name="participant_gender" class="form-select">
                      <option value="">Select gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="participant-language" class="form-label">Preferred Language</label>
                    <select id="participant-language" name="participant_language" class="form-select">
                      <option value="english">English</option>
                      <option value="bahasa">Bahasa Malaysia</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="participant-weight" class="form-label">Care Recipient Weight</label>
                    <input
                      type="number"
                      id="participant-weight"
                      name="participant_weight"
                      class="form-input"
                      placeholder="Weight in kg"
                    />
                  </div>

                  <div class="form-group">
                    <label for="participant-height" class="form-label">Care Recipient Height</label>
                    <input
                      type="number"
                      id="participant-height"
                      name="participant_height"
                      class="form-input"
                      placeholder="Height in cm"
                    />
                  </div>
                </div>
              </div>

              <!-- Activity Preferences -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-star"></i>
                  Activity Preferences & Interests
                </h3>

                <div class="form-group">
                  <label for="activities-list" class="form-label">Activities You'd Like to Do: *</label>
                  <textarea
                    id="activities-list"
                    name="activities_list"
                    class="form-textarea"
                    rows="4"
                    placeholder="Please describe the activities, locations, and any specific requirements. For example: Shopping at mall, visit to park, recreational activities, social outings, etc."
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="activity-pace" class="form-label">Preferred Activity Pace</label>
                  <select id="activity-pace" name="activity_pace" class="form-select">
                    <option value="">Select pace preference</option>
                    <option value="relaxed">Relaxed & leisurely</option>
                    <option value="moderate">Moderate pace</option>
                    <option value="active">Active & energetic</option>
                    <option value="flexible">Flexible, adapt as needed</option>
                  </select>
                </div>
              </div>

              <!-- Activity Scheduling -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-calendar-alt"></i>
                  Activity Scheduling
                </h3>

                <!-- Multi-date calendar -->
                <div class="form-group">
                  <label for="activity-dates" class="form-label">Select Activity Dates *</label>
                  <input
                    type="text"
                    id="activity-dates"
                    name="activity_dates"
                    class="form-input"
                    placeholder="Select activity dates"
                    readonly
                    required
                  />
                  <small class="form-help">Select specific dates; today and tomorrow are disabled</small>
                  <div id="activity-date-limit-message" style="display:none; color: #666; margin-top: 5px; font-size: 0.875rem;">
                    If you're unsure of the remaining dates, you may plan or book them later with our representative.
                  </div>
                  <div id="activity-date-count" style="color: #666; margin-top: 5px; font-size: 0.875rem;">
                    Selected dates: <span id="activity-selected-count">0</span>/<span id="activity-max-dates">0</span> sessions
                  </div>
                  <div id="activity-hours-info" style="color: #f59e0b; margin-top: 5px; font-size: 0.875rem; font-weight: 500;">
                    Please select hours in Step 1 first to enable date selection
                  </div>
                </div>

                <!-- 30-Day Validity Disclaimer -->
                <div style="background: #fef2f2; border: 2px dashed #dc2626; border-radius: 12px; padding: 16px; margin: 20px 0;">
                  <h4 style="color: #dc2626; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-exclamation-triangle"></i>
                    Important: Validity Period
                  </h4>
                  <p style="color: #dc2626; font-size: 14px; margin: 0;">
                    <strong>All unused hours are only valid for 30 days after booking.</strong> Please plan your activity dates within this period to avoid forfeiture of unused hours.
                  </p>
                </div>

                <div class="form-grid">
                  <div class="form-group">
                    <label for="activity-time" class="form-label">Preferred Start Time *</label>
                    <select id="activity-time" name="activity_time" class="form-select" required>
                      <option value="">Select time</option>
                      <option value="07:00">07:00 AM</option>
                      <option value="08:00">08:00 AM</option>
                      <option value="09:00">09:00 AM</option>
                      <option value="10:00">10:00 AM</option>
                      <option value="11:00">11:00 AM</option>
                      <option value="12:00">12:00 PM</option>
                      <option value="13:00">01:00 PM</option>
                      <option value="14:00">02:00 PM</option>
                      <option value="15:00">03:00 PM</option>
                      <option value="16:00">04:00 PM</option>
                      <option value="17:00">05:00 PM</option>
                      <option value="18:00">06:00 PM</option>
                      <option value="19:00">07:00 PM</option>
                      <option value="20:00">08:00 PM</option>
                      <option value="21:00">09:00 PM</option>
                    </select>
                    <small class="form-help">Same start time will apply to all selected dates</small>
                  </div>

                  <div class="form-group">
                    <label for="duration" class="form-label">Estimated Activity Duration</label>
                    <select id="duration" name="duration" class="form-select">
                      <option value="short">Less than 2 hours</option>
                      <option value="long">More than 2 hours</option>
                      <option value="flexible">Not Sure</option>
                    </select>
                    <small class="form-help">For recurring activities, the same session pattern will repeat</small>
                  </div>
                </div>
              </div>

              <!-- Activity Locations -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-map-marker-alt"></i>
                  Activity Locations & Meeting Point
                </h3>
                <div class="form-group">
                  <label for="meeting-address" class="form-label">Meeting/Pickup Address *</label>
                  <textarea
                    id="meeting-address"
                    name="meeting_address"
                    class="form-textarea"
                    rows="3"
                    placeholder="Address where our Temanion should meet you"
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="activity-locations" class="form-label">Activity Locations *</label>
                  <textarea
                    id="activity-locations"
                    name="activity_locations"
                    class="form-textarea"
                    rows="3"
                    placeholder="List the places you'd like to visit (malls, parks, restaurants, etc.)"
                    required
                  ></textarea>
                </div>

                <div class="form-grid">
                  <div class="form-group">
                    <label for="postcode" class="form-label">Area Postcode</label>
                    <input
                      type="text"
                      id="postcode"
                      name="postcode"
                      class="form-input"
                      placeholder="e.g. 50200"
                      pattern="[0-9]{5}"
                    />
                  </div>

                  <div class="form-group">
                    <label for="city" class="form-label">City/Area</label>
                    <input
                      type="text"
                      id="city"
                      name="city"
                      class="form-input"
                      placeholder="e.g. Kuala Lumpur"
                    />
                  </div>
                </div>
              </div>

              <!-- Transportation -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-car"></i>
                  Transportation for Activities
                </h3>
                <div style="display: grid; gap: 12px;">
                  <label class="radio-option">
                    <input type="radio" name="transportation_mode" value="client-provided" required />
                    <span class="radio-custom"></span>
                    <div class="radio-content">
                      <strong>I will provide transportation</strong>
                    </div>
                  </label>

                  <label class="radio-option">
                    <input type="radio" name="transportation_mode" value="teman-provided" required />
                    <span class="radio-custom"></span>
                    <div class="radio-content">
                      <strong>Temanion will arrange transportation</strong>
                    </div>
                  </label>

                  <label class="radio-option">
                    <input type="radio" name="transportation_mode" value="e-hailing" required />
                    <span class="radio-custom"></span>
                    <div class="radio-content">
                      <strong>E-Hailing Service (Grab/Taxi)</strong>
                    </div>
                  </label>
                </div>

                <div class="form-group" style="margin-top: 16px">
                  <label for="transportation-notes" class="form-label">Transportation Notes</label>
                  <textarea
                    id="transportation-notes"
                    name="transportation_notes"
                    class="form-textarea"
                    rows="2"
                    placeholder="Any specific transportation preferences, accessibility needs, or special instructions..."
                  ></textarea>
                </div>
              </div>

              <!-- Health & Mobility Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-notes-medical"></i>
                  Health & Mobility Information
                </h3>

                <div class="form-group">
                  <label for="health-conditions" class="form-label">Health Conditions or Limitations</label>
                  <textarea
                    id="health-conditions"
                    name="health_conditions"
                    class="form-textarea"
                    rows="3"
                    placeholder="Any health conditions, mobility limitations, or medical concerns that might affect activities..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="mobility-assistance" class="form-label">Mobility Assistance Needed</label>
                  <select id="mobility-assistance" name="mobility_assistance" class="form-select">
                    <option value="none">None</option>
                    <option value="wheelchair">Wheelchair assistance</option>
                    <option value="walker">Walker/walking aid</option>
                    <option value="walking">Walking assistance</option>
                    <option value="other">Other</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="dietary-restrictions" class="form-label">Dietary Restrictions or Allergies</label>
                  <textarea
                    id="dietary-restrictions"
                    name="dietary_restrictions"
                    class="form-textarea"
                    rows="2"
                    placeholder="Food allergies, dietary restrictions, or preferences for dining activities..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="emergency-procedures" class="form-label">Emergency Procedures or Medical Information</label>
                  <textarea
                    id="emergency-procedures"
                    name="emergency_procedures"
                    class="form-textarea"
                    rows="3"
                    placeholder="Any emergency procedures, medications carried, or important medical information the companion should know..."
                  ></textarea>
                </div>
              </div>

              <!-- Companion Preferences -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-user-friends"></i>
                  Companion Preferences
                </h3>

                <div class="form-grid">
                  <div class="form-group">
                    <label for="companion-gender" class="form-label">Preferred Gender</label>
                    <select id="companion-gender" name="companion_gender" class="form-select">
                      <option value="no-preference">No preference</option>
                      <option value="female">Female</option>
                      <option value="male">Male</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="companion-language" class="form-label">Language Preference</label>
                    <select id="companion-language" name="companion_language" class="form-select">
                      <option value="english">English</option>
                      <option value="bahasa">Bahasa Malaysia</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Additional Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-comment-dots"></i>
                  Additional Information
                </h3>

                <div class="form-group">
                  <label for="activity-goals" class="form-label">Activity Goals & Expectations</label>
                  <textarea
                    id="activity-goals"
                    name="activity_goals"
                    class="form-textarea"
                    rows="3"
                    placeholder="What do you hope to achieve from these activities? (e.g., social interaction, exercise, enjoyment, exploration, etc.)"
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="previous-experiences" class="form-label">Previous Activity Experiences</label>
                  <textarea
                    id="previous-experiences"
                    name="previous_experiences"
                    class="form-textarea"
                    rows="2"
                    placeholder="Tell us about activities you've enjoyed before or would like to try again..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="additional-notes" class="form-label">Additional Notes & Special Requests</label>
                  <textarea
                    id="additional-notes"
                    name="additional_notes"
                    class="form-textarea"
                    rows="4"
                    placeholder="Any other information, preferences, concerns, or special requests that would help us provide the best experience..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="how-heard" class="form-label">How did you hear about us? *</label>
                  <select id="how-heard" name="how_heard" class="form-select" required>
                    <option value="">Please select an option</option>
                    <option value="google">Google Search</option>
                    <option value="facebook">Facebook</option>
                    <option value="instagram">Instagram</option>
                    <option value="friend">Friend/Family Referral</option>
                    <option value="doctor">Doctor/Medical Professional</option>
                    <option value="community-center">Community Center</option>
                    <option value="newspaper">Newspaper/Magazine</option>
                    <option value="radio">Radio</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>

              <div class="form-actions">
                <button type="button" class="btn btn--outline btn--large" onclick="prevStep()">
                  <i class="fas fa-arrow-left"></i>
                  Previous
                </button>
                <button type="button" class="btn btn--primary btn--large" onclick="nextStep()">
                  Review Booking
                  <i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>

            <!-- Step 3: Confirmation -->
            <div class="form-step" data-step="3">
              <h2 class="step-title">Booking Summary & Payment</h2>

              <div class="booking-summary">
                <!-- Service Details -->
                <div class="summary-card">
                  <h3><i class="fas fa-clipboard-list"></i> Service Details</h3>
                  <div class="summary-item">
                    <span class="summary-label">Service:</span>
                    <span class="summary-value">Custom Activities Companion</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Package:</span>
                    <span class="summary-value" id="summary-package">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Duration:</span>
                    <span class="summary-value" id="summary-duration">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Selected Dates:</span>
                    <span class="summary-value" id="summary-dates">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Start Time:</span>
                    <span class="summary-value" id="summary-time">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Transportation:</span>
                    <span class="summary-value" id="summary-transportation">-</span>
                  </div>
                  <div class="summary-item total">
                    <span class="summary-label">Base Service Cost:</span>
                    <span class="summary-value" id="summary-total">RM 0</span>
                  </div>
                  <p class="cost-note">
                    *Final cost may include transportation fees (RM0.80/KM + RM20 allowance), surcharges for holidays/weekends, and personal activity expenses
                  </p>
                </div>

                <!-- Activities & Preferences -->
                <div class="summary-card">
                  <h3><i class="fas fa-star"></i> Activities & Preferences</h3>
                  <div class="summary-item">
                    <span class="summary-label">Activities:</span>
                    <span class="summary-value" id="summary-activities">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Activity Pace:</span>
                    <span class="summary-value" id="summary-pace">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Meeting Point:</span>
                    <span class="summary-value" id="summary-meeting-point">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Activity Locations:</span>
                    <span class="summary-value" id="summary-locations">-</span>
                  </div>
                </div>

                <!-- Contact Information -->
                <div class="summary-card">
                  <h3><i class="fas fa-user"></i> Contact Information</h3>
                  <div class="summary-item">
                    <span class="summary-label">Name:</span>
                    <span class="summary-value" id="summary-name">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Phone:</span>
                    <span class="summary-value" id="summary-phone">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Email:</span>
                    <span class="summary-value" id="summary-email">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Emergency Contact:</span>
                    <span class="summary-value" id="summary-emergency">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Relationship:</span>
                    <span class="summary-value" id="summary-relationship">-</span>
                  </div>
                </div>

                <!-- Care Recipient Details -->
                <div class="summary-card">
                  <h3><i class="fas fa-heart-pulse"></i> Care Recipient Details</h3>
                  <div class="summary-item">
                    <span class="summary-label">Name:</span>
                    <span class="summary-value" id="summary-participant-name">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Age & Gender:</span>
                    <span class="summary-value" id="summary-participant-details">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Language:</span>
                    <span class="summary-value" id="summary-participant-language">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Health Notes:</span>
                    <span class="summary-value" id="summary-health">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Mobility Assistance:</span>
                    <span class="summary-value" id="summary-mobility">-</span>
                  </div>
                </div>

                <!-- Companion Preferences -->
                <div class="summary-card">
                  <h3><i class="fas fa-user-friends"></i> Companion Preferences</h3>
                  <div class="summary-item">
                    <span class="summary-label">Preferred Gender:</span>
                    <span class="summary-value" id="summary-companion-gender">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Language Preference:</span>
                    <span class="summary-value" id="summary-companion-language">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Activity Goals:</span>
                    <span class="summary-value" id="summary-goals">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Additional Notes:</span>
                    <span class="summary-value" id="summary-notes">-</span>
                  </div>
                </div>
              </div>

              <!-- What Happens Next -->
              <div style="background: #fffbeb; border: 1px solid #fed7aa; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
                <h3 style="display: flex; align-items: center; gap: 8px; color: #d97706; margin-bottom: 16px;">
                  <i class="fas fa-info-circle"></i> What Happens Next?
                </h3>
                <ul style="list-style: none; padding: 0;">
                  <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: #d97706;">
                    <i class="fas fa-credit-card" style="width: 20px; text-align: center;"></i>
                    Pay the deposit to secure your booking
                  </li>
                  <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: #d97706;">
                    <i class="fas fa-phone" style="width: 20px; text-align: center;"></i>
                    Our team will contact you within 24 hours to confirm details
                  </li>
                  <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: #d97706;">
                    <i class="fas fa-user-check" style="width: 20px; text-align: center;"></i>
                    We will match you with a Temanion who shares your interests
                  </li>
                  <li style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px; color: #d97706;">
                    <i class="fas fa-map" style="width: 20px; text-align: center;"></i>
                    We will help plan the perfect itinerary for your activities
                  </li>
                  <li style="display: flex; align-items: center; gap: 12px; color: #d97706;">
                    <i class="fas fa-star" style="width: 20px; text-align: center;"></i>
                    Enjoy your personalized activity experience!
                  </li>
                </ul>
              </div>

              <!-- Activity Tips -->
              <div style="background: #fef3c7; border: 1px solid #fcd34d; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
                <h3 style="display: flex; align-items: center; gap: 8px; color: #92400e; margin-bottom: 16px;">
                  <i class="fas fa-lightbulb"></i> Activity Tips & Reminders
                </h3>
                <ul style="list-style: none; padding: 0;">
                  <li style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 8px; color: #92400e;">
                    <i class="fas fa-clock" style="width: 20px; text-align: center; margin-top: 2px;"></i>
                    Please arrive 10-15 minutes early at the meeting point
                  </li>
                  <li style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 8px; color: #92400e;">
                    <i class="fas fa-wallet" style="width: 20px; text-align: center; margin-top: 2px;"></i>
                    Bring payment for personal expenses (meals, tickets, purchases)
                  </li>
                  <li style="display: flex; align-items: flex-start; gap: 12px; margin-bottom: 8px; color: #92400e;">
                    <i class="fas fa-umbrella" style="width: 20px; text-align: center; margin-top: 2px;"></i>
                    Check weather conditions and dress appropriately for activities
                  </li>
                  <li style="display: flex; align-items: flex-start; gap: 12px; color: #92400e;">
                    <i class="fas fa-mobile-alt" style="width: 20px; text-align: center; margin-top: 2px;"></i>
                    Your Temanion's contact details will be shared before the activity
                  </li>
                </ul>
              </div>

              <!-- Fixed Terms & Conditions Checkbox -->
              <label class="terms-checkbox">
                <input type="checkbox" name="terms_agreed" required />
                <span class="checkmark"></span>
                <span class="terms-text">
                  I agree to the <a href="#" target="_blank">Terms & Conditions</a> and 
                  <a href="#" target="_blank">Privacy Policy</a>. I understand that activity expenses are separate from the companion fee and that a deposit is required to secure the booking.
                </span>
              </label>

              <div class="form-actions">
                <button type="button" class="btn btn--outline btn--large" onclick="prevStep()">
                  <i class="fas fa-arrow-left"></i>
                  Previous
                </button>
                <button type="button" class="btn btn--success btn--large" id="pay-deposit-btn" onclick="proceedToPayment()">
                  <i class="fas fa-credit-card"></i>
                  Pay Deposit & Confirm Booking
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Success Modal -->
    <div id="booking-success-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>Booking Request Submitted!</h2>
        <p>
          Thank you for choosing Teman Malaysia for your custom activity experience. 
          We've received your booking request and will contact you within 24 hours to finalize the activity details and match you with the perfect companion.
        </p>
        <div class="booking-reference">
          <strong>Reference Number: <span id="booking-ref-number"></span></strong>
        </div>
        <div class="modal-actions">
          <button class="btn btn--primary" onclick="window.location.href='booking.html'">
            Book Another Service
          </button>
          <button class="btn btn--outline" onclick="closeModal()">Close</button>
        </div>
      </div>
    </div>

    <!-- Footer Component -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
      // Current step tracking
      let currentStep = 1;
      const totalSteps = 3;

      // Update progress steps visual state
      function updateProgressSteps() {
        const steps = document.querySelectorAll(".step");

        steps.forEach((step, index) => {
          const stepNumber = index + 1;
          step.classList.remove("active", "completed");

          if (stepNumber < currentStep) {
            step.classList.add("completed");
          } else if (stepNumber === currentStep) {
            step.classList.add("active");
          }
        });
      }

      // Navigate to next step
      function nextStep() {
        if (currentStep < totalSteps) {
          if (validateCurrentStep()) {
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove("active");
            currentStep++;
            document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add("active");
            updateProgressSteps();

            if (currentStep === 3) {
              updateBookingSummary();
            }

            window.scrollTo({ top: 0, behavior: "smooth" });
          }
        }
      }

      // Navigate to previous step
      function prevStep() {
        if (currentStep > 1) {
          document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove("active");
          currentStep--;
          document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add("active");
          updateProgressSteps();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      }

      // Enhanced validation function
      function validateCurrentStep() {
        clearValidationErrors();

        if (currentStep === 1) {
          // Validate package selection
          const packageSelected = document.querySelector('input[name="package"]:checked');
          if (!packageSelected) {
            showValidationError("Please select a package before continuing.");
            return false;
          }

          // Validate hours for hourly packages
          if (packageSelected.value === "hourly") {
            const hoursSelected = document.getElementById("hours").value;
            if (!hoursSelected) {
              showValidationError("Please select the number of hours.", "hours");
              return false;
            }
          }

        } else if (currentStep === 2) {
          // Required fields validation
          const requiredFields = [
            { name: "full_name", label: "Full Name" },
            { name: "phone", label: "Phone Number" },
            { name: "email", label: "Email Address" },
            { name: "emergency_contact", label: "Emergency Contact" },
            { name: "activities_list", label: "Activities List" },
            { name: "activity_dates", label: "Activity Dates" },
            { name: "activity_time", label: "Activity Start Time" },
            { name: "meeting_address", label: "Meeting/Pickup Address" },
            { name: "activity_locations", label: "Activity Locations" },
            { name: "how_heard", label: "How did you hear about us?" }
          ];

          for (let field of requiredFields) {
            const element = document.querySelector(`[name="${field.name}"]`);
            if (!element || !element.value.trim()) {
              showValidationError(`Please fill in the ${field.label} field.`, field.name);
              element.focus();
              return false;
            }
          }

          // Validate transportation mode
          const transportationSelected = document.querySelector('input[name="transportation_mode"]:checked');
          if (!transportationSelected) {
            showValidationError("Please select a transportation mode.");
            document.querySelector('input[name="transportation_mode"]').focus();
            return false;
          }

          // Validate email format
          const email = document.querySelector('[name="email"]').value;
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(email)) {
            showValidationError("Please enter a valid email address.", "email");
            return false;
          }

        } else if (currentStep === 3) {
          // Validate terms agreement
          const termsAgreed = document.querySelector('input[name="terms_agreed"]:checked');
          if (!termsAgreed) {
            showValidationError("Please agree to the Terms & Conditions and Privacy Policy to continue.");
            return false;
          }
        }

        return true;
      }

      // Show validation error
      function showValidationError(message, fieldName = null) {
        alert(message);
        
        if (fieldName) {
          const field = document.querySelector(`[name="${fieldName}"], #${fieldName}`);
          if (field) {
            field.classList.add('error');
            field.focus();
          }
        }
      }

      // Clear validation errors
      function clearValidationErrors() {
        const errorFields = document.querySelectorAll('.error');
        errorFields.forEach(field => field.classList.remove('error'));
      }

      // Enhanced booking summary update
      function updateBookingSummary() {
        // Package details
        const selectedPackage = document.querySelector('input[name="package"]:checked');
        let packageInfo = "";
        let estimatedCost = 0;

        if (selectedPackage) {
          if (selectedPackage.value === "hourly") {
            const hours = document.getElementById("hours").value;
            if (hours === "custom") {
              packageInfo = "Hourly Rate - Custom hours (Contact for quote)";
              estimatedCost = "Contact for quote";
            } else {
              packageInfo = `Hourly Rate - ${hours} hours`;
              estimatedCost = hours * 35;
            }
          }
        }

        // Update summary fields
        document.getElementById("summary-package").textContent = packageInfo || "-";
        document.getElementById("summary-duration").textContent = 
          document.getElementById("hours").value ? `${document.getElementById("hours").value} hours` : "-";
        document.getElementById("summary-total").textContent = 
          typeof estimatedCost === "number" ? `RM ${estimatedCost}` : estimatedCost;

        // Activity dates
        const activityDates = document.getElementById("activity-dates").value;
        document.getElementById("summary-dates").textContent = activityDates || "-";
        
        // Start time
        const startTime = document.getElementById("activity-time").value;
        document.getElementById("summary-time").textContent = startTime || "-";

        // Transportation
        const transportation = document.querySelector('input[name="transportation_mode"]:checked');
        if (transportation) {
          const transportLabel = transportation.nextElementSibling.nextElementSibling.querySelector("strong").textContent;
          document.getElementById("summary-transportation").textContent = transportLabel;
        }

        // Activities
        const activities = document.getElementById("activities-list").value;
        document.getElementById("summary-activities").textContent = 
          activities ? (activities.length > 100 ? activities.substring(0, 100) + "..." : activities) : "-";

        // Activity pace
        const pace = document.getElementById("activity-pace").value;
        document.getElementById("summary-pace").textContent = 
          pace ? pace.charAt(0).toUpperCase() + pace.slice(1).replace('-', ' & ') : "Not specified";

        // Meeting point
        const meetingAddress = document.getElementById("meeting-address").value;
        document.getElementById("summary-meeting-point").textContent = 
          meetingAddress ? (meetingAddress.length > 80 ? meetingAddress.substring(0, 80) + "..." : meetingAddress) : "-";

        // Activity locations
        const locations = document.getElementById("activity-locations").value;
        document.getElementById("summary-locations").textContent = 
          locations ? (locations.length > 80 ? locations.substring(0, 80) + "..." : locations) : "-";

        // Contact information
        document.getElementById("summary-name").textContent = 
          document.getElementById("full-name").value || "-";
        document.getElementById("summary-phone").textContent = 
          document.getElementById("phone").value || "-";
        document.getElementById("summary-email").textContent = 
          document.getElementById("email").value || "-";
        document.getElementById("summary-emergency").textContent = 
          document.getElementById("emergency-contact").value || "-";

        // Relationship
        const relationship = document.getElementById("relationship").value;
        document.getElementById("summary-relationship").textContent = 
          relationship ? relationship.charAt(0).toUpperCase() + relationship.slice(1).replace('-', ' ') : "Not specified";

        // Participant info
        const participantName = document.getElementById("participant-name").value;
        const participantAge = document.getElementById("participant-age").value;
        const participantGender = document.getElementById("participant-gender").value;
        
        document.getElementById("summary-participant-name").textContent = 
          participantName || (relationship === "self" ? "Self" : "Not specified");
        
        let participantDetails = "";
        if (participantAge && participantGender) {
          participantDetails = `Age: ${participantAge}, ${participantGender.charAt(0).toUpperCase() + participantGender.slice(1)}`;
        } else if (participantAge) {
          participantDetails = `Age: ${participantAge}`;
        } else if (participantGender) {
          participantDetails = participantGender.charAt(0).toUpperCase() + participantGender.slice(1);
        }
        document.getElementById("summary-participant-details").textContent = participantDetails || "Not specified";

        // Participant language
        const participantLanguage = document.getElementById("participant-language").value;
        document.getElementById("summary-participant-language").textContent = 
          participantLanguage ? participantLanguage.charAt(0).toUpperCase() + participantLanguage.slice(1) : "English";

        // Health conditions
        const healthConditions = document.getElementById("health-conditions").value;
        document.getElementById("summary-health").textContent = 
          healthConditions ? (healthConditions.length > 100 ? healthConditions.substring(0, 100) + "..." : healthConditions) : "None specified";

        // Mobility assistance
        const mobility = document.getElementById("mobility-assistance").value;
        document.getElementById("summary-mobility").textContent = 
          mobility && mobility !== "none" ? mobility.charAt(0).toUpperCase() + mobility.slice(1).replace('-', ' ') : "None";

        // Companion preferences
        const companionGender = document.getElementById("companion-gender").value;
        document.getElementById("summary-companion-gender").textContent = 
          companionGender ? companionGender.charAt(0).toUpperCase() + companionGender.slice(1).replace('-', ' ') : "No preference";

        const companionLanguage = document.getElementById("companion-language").value;
        document.getElementById("summary-companion-language").textContent = 
          companionLanguage ? companionLanguage.charAt(0).toUpperCase() + companionLanguage.slice(1) : "English";

        // Activity goals
        const goals = document.getElementById("activity-goals").value;
        document.getElementById("summary-goals").textContent = 
          goals ? (goals.length > 100 ? goals.substring(0, 100) + "..." : goals) : "Not specified";

        // Additional notes
        const notes = document.getElementById("additional-notes").value;
        document.getElementById("summary-notes").textContent = 
          notes ? (notes.length > 100 ? notes.substring(0, 100) + "..." : notes) : "None";
      }

      // Payment processing function
      function proceedToPayment() {
        // Validate terms agreement before proceeding
        const termsAgreed = document.querySelector('input[name="terms_agreed"]:checked');
        if (!termsAgreed) {
          alert("Please agree to the Terms & Conditions and Privacy Policy before proceeding to payment.");
          return;
        }

        // Show loading state
        const payButton = document.getElementById('pay-deposit-btn');
        const originalText = payButton.innerHTML;
        payButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
        payButton.disabled = true;

        // Generate booking reference
        const refNumber = "TM" + Date.now().toString().slice(-6);
        
        // Store booking data (in real implementation, this would be sent to backend)
        const bookingData = {
          reference: refNumber,
          package: document.querySelector('input[name="package"]:checked')?.value,
          hours: document.getElementById("hours").value,
          contactName: document.getElementById("full-name").value,
          phone: document.getElementById("phone").value,
          email: document.getElementById("email").value,
          timestamp: new Date().toISOString()
        };

        console.log("Booking Data:", bookingData);

        // Simulate form submission delay, then redirect
        setTimeout(() => {
          // Redirect to Billplz payment page
          window.location.href = "https://www.billplz.com/deposit4Teman";
        }, 1500);
      }

      // Flatpickr and date selection logic
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(today.getDate() + 1);
      const dayAfterTomorrow = new Date(today);
      dayAfterTomorrow.setDate(today.getDate() + 2);

      function formatDate(date) {
        return date.toISOString().split('T')[0];
      }

      const minDateStr = formatDate(dayAfterTomorrow);
      const messageEl = document.getElementById("activity-date-limit-message");
      const countEl = document.getElementById("activity-selected-count");
      const maxDatesEl = document.getElementById("activity-max-dates");
      const hoursInfoEl = document.getElementById("activity-hours-info");
      const activityDatesInput = document.getElementById("activity-dates");

      let fp = null;
      let maxAllowedSessions = 0;

      function calculateMaxSessions() {
        const selectedPackage = document.querySelector('input[name="package"]:checked');
        
        if (!selectedPackage) {
          maxAllowedSessions = 0;
          maxDatesEl.textContent = "0";
          hoursInfoEl.textContent = "Please select a package first to enable date selection";
          hoursInfoEl.style.color = "#f59e0b";
          activityDatesInput.disabled = true;
          if (fp) fp.set('disabled', true);
          return;
        }

        let totalHours = 0;
        
        if (selectedPackage.value === "hourly") {
          const hoursSelect = document.getElementById("hours");
          if (hoursSelect.value && hoursSelect.value !== "custom") {
            totalHours = parseInt(hoursSelect.value) || 0;
          }
        }

        if (totalHours > 0) {
          maxAllowedSessions = Math.ceil(totalHours / 2);
          
          maxDatesEl.textContent = maxAllowedSessions;
          
          let sessionText = "";
          if (totalHours <= 2) {
            sessionText = "1 session";
          } else if (totalHours <= 4) {
            sessionText = "2 sessions";
          } else if (totalHours <= 6) {
            sessionText = "3 sessions";
          } else {
            sessionText = `${maxAllowedSessions} sessions`;
          }
          
          hoursInfoEl.textContent = `Based on ${totalHours} hours selected - you can select up to ${sessionText}`;
          hoursInfoEl.style.color = "#10b981";
          
          activityDatesInput.disabled = false;
          if (fp) {
            fp.set('disabled', false);
            if (fp.selectedDates.length > maxAllowedSessions) {
              fp.clear();
            }
          }
        } else {
          maxAllowedSessions = 0;
          maxDatesEl.textContent = "0";
          hoursInfoEl.textContent = "Please select hours to enable date selection";
          hoursInfoEl.style.color = "#f59e0b";
          activityDatesInput.disabled = true;
          if (fp) fp.set('disabled', true);
        }

        updateDateSelection(fp ? fp.selectedDates : [], fp);
      }

      function initializeFlatpickr() {
        fp = flatpickr("#activity-dates", {
          mode: "multiple",
          dateFormat: "Y-m-d",
          disable: [formatDate(today), formatDate(tomorrow)],
          minDate: minDateStr,
          disabled: true,
          onChange: function(selectedDates, dateStr, instance) {
            updateDateSelection(selectedDates, instance);
          },
          onReady: function(selectedDates, dateStr, instance) {
            updateDateSelection(selectedDates, instance);
          }
        });
      }

      function updateDateSelection(selectedDates, instance) {
        if (!instance) return;
        
        const count = selectedDates.length;
        countEl.textContent = count;
        
        if (count < maxAllowedSessions && maxAllowedSessions > 0) {
          messageEl.style.display = "block";
        } else {
          messageEl.style.display = "none";
        }
        
        if (count >= maxAllowedSessions && maxAllowedSessions > 0) {
          const calendar = instance.calendarContainer;
          if (calendar) {
            const unselectedDays = calendar.querySelectorAll('.flatpickr-day:not(.selected):not(.flatpickr-disabled)');
            unselectedDays.forEach(day => {
              day.style.opacity = '0.3';
              day.style.pointerEvents = 'none';
            });
          }
        } else {
          const calendar = instance.calendarContainer;
          if (calendar) {
            const unselectedDays = calendar.querySelectorAll('.flatpickr-day:not(.selected):not(.flatpickr-disabled)');
            unselectedDays.forEach(day => {
              day.style.opacity = '';
              day.style.pointerEvents = '';
            });
          }
        }
      }

      // Close modal function  
      function closeModal() {
        document.getElementById("booking-success-modal").style.display = "none";
      }

      // Event listeners
      document.addEventListener('DOMContentLoaded', function() {
        initializeFlatpickr();
        calculateMaxSessions();
        updateProgressSteps();

        // Package and hours change listeners
        document.addEventListener('change', function(e) {
          if (e.target.name === 'package' || e.target.id === 'hours') {
            calculateMaxSessions();
          }

          // Show/hide hours selection for different packages
          if (e.target.name === 'package') {
            const hoursSelections = document.querySelectorAll('.hours-selection');
            hoursSelections.forEach(selection => {
              selection.style.display = 'none';
            });

            if (e.target.value === 'hourly') {
              document.querySelector('#hourly-package + .package-card .hours-selection').style.display = 'block';
            }
          }
        });
      });

      // Load header and footer components
      async function loadComponents() {
        try {
          const headerResponse = await fetch("../components/header.html");
          if (headerResponse.ok) {
            const headerHTML = await headerResponse.text();
            document.getElementById("header-placeholder").innerHTML = headerHTML;

            setTimeout(() => {
              const bookingLink = document.querySelector('a[href="booking.html"]');
              if (bookingLink) {
                bookingLink.classList.add("active");
              }
              initializeNavigation();
            }, 100);
          }

          const footerResponse = await fetch("../components/footer.html");
          if (footerResponse.ok) {
            const footerHTML = await footerResponse.text();
            document.getElementById("footer-placeholder").innerHTML = footerHTML;
          }

          initializeMainJS();
        } catch (error) {
          console.error("Error loading components:", error);
        }
      }

      function initializeNavigation() {
        const navToggle = document.getElementById("nav-toggle");
        const navMenu = document.getElementById("nav-menu");

        if (navToggle && navMenu) {
          navToggle.addEventListener("click", () => {
            navMenu.classList.toggle("show");
            const icon = navToggle.querySelector("i");
            if (navMenu.classList.contains("show")) {
              icon.className = "fas fa-times";
            } else {
              icon.className = "fas fa-bars";
            }
          });

          document.querySelectorAll(".nav__link").forEach((link) => {
            link.addEventListener("click", () => {
              navMenu.classList.remove("show");
              const icon = navToggle.querySelector("i");
              if (icon) icon.className = "fas fa-bars";
            });
          });

          document.addEventListener("click", (e) => {
            if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
              navMenu.classList.remove("show");
              const icon = navToggle.querySelector("i");
              if (icon) icon.className = "fas fa-bars";
            }
          });
        }

        window.addEventListener("scroll", () => {
          const header = document.getElementById("header");
          if (header) {
            if (window.scrollY > 100) {
              header.style.background = "rgba(255, 255, 255, 0.98)";
              header.style.boxShadow = "0 2px 20px rgba(0, 0, 0, 0.1)";
            } else {
              header.style.background = "rgba(255, 255, 255, 0.95)";
              header.style.boxShadow = "none";
            }
          }
        });
      }

      function initializeMainJS() {
        console.log("Teman Malaysia custom activities booking loaded successfully!");
      }

      document.addEventListener("DOMContentLoaded", function () {
        loadComponents();
      });
    </script>
    <script src="../assets/js/main.js"></script>
  </body>
</html>