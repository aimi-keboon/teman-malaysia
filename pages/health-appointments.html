<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Health Appointment Support - Teman Malaysia</title>
    <meta
      name="description"
      content="Book professional assistance for medical checkups and treatments with Teman Malaysia. Caring companionship for your health appointments."
    />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/images/favicon.png" />
    <link rel="apple-touch-icon" href="../assets/images/apple-touch-icon.png" />

    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/main.css" />
    <link rel="stylesheet" href="../assets/css/responsive.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Include Flatpickr CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />

    <style>
      /* Reset and base styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
        color: #374151;
        background: #f9fafb;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* Header Styles */
      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
        transition: all 0.3s ease;
      }

      .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
      }

      .nav__logo {
        height: 40px;
        width: auto;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .btn--primary {
        background: #3b82f6;
        color: white;
      }

      .btn--primary:hover {
        background: #2563eb;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      }

      .btn--outline {
        background: transparent;
        color: #3b82f6;
        border: 2px solid #3b82f6;
      }

      .btn--outline:hover {
        background: #3b82f6;
        color: white;
        transform: translateY(-2px);
      }

      .btn--large {
        padding: 16px 32px;
        font-size: 16px;
      }

      .btn--secondary {
        background: #10b981;
        color: white;
      }

      .btn--secondary:hover {
        background: #059669;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }

      .btn--payment {
        background: #f59e0b;
        color: white;
        font-size: 18px;
        padding: 20px 40px;
        border-radius: 12px;
        font-weight: 600;
      }

      .btn--payment:hover {
        background: #d97706;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
      }

      /* Main Section */
      .booking-section {
        padding: 120px 0 80px 0;
        min-height: 100vh;
      }

      .booking__header {
        text-align: center;
        margin-bottom: 60px;
      }

      .booking__title {
        font-size: 3rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 16px;
      }

      .booking__subtitle {
        font-size: 1.25rem;
        color: #6b7280;
        max-width: 600px;
        margin: 0 auto;
      }

      .service-info-card {
        background: white;
        border-radius: 16px;
        padding: 32px;
        margin: 0 auto 40px auto;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 2px solid #e5f3ff;
        max-width: 800px;
      }

      .service-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
      }

      .service-icon {
        width: 60px;
        height: 60px;
        background: #3b82f6;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .service-icon i {
        font-size: 24px;
        color: white;
      }

      .service-header h2 {
        font-size: 1.75rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
      }

      .service-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-top: 24px;
      }

      .feature-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #4b5563;
      }

      .feature-item i {
        color: #10b981;
        font-size: 12px;
      }

      /* Progress Steps */
      .progress-steps {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 40px 0 60px 0;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        gap: 80px;
      }

      .step {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .step__number {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 18px;
        background: #e5e7eb;
        color: #6b7280;
        border: 3px solid #e5e7eb;
        transition: all 0.3s ease;
        margin-bottom: 12px;
      }

      .step.active .step__number {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
      }

      .step.completed .step__number {
        background: #10b981;
        color: white;
        border-color: #10b981;
      }

      .step__label {
        font-size: 14px;
        font-weight: 500;
        color: #6b7280;
        text-align: center;
        transition: color 0.3s ease;
        white-space: nowrap;
      }

      .step.active .step__label {
        color: #3b82f6;
        font-weight: 600;
      }

      .step.completed .step__label {
        color: #10b981;
        font-weight: 600;
      }

      /* Form Container */
      .booking__container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        overflow: hidden;
      }

      /* Form Styles */
      .booking-form {
        padding: 40px;
      }

      .form-step {
        display: none;
      }

      .form-step.active {
        display: block;
      }

      .step-title {
        font-size: 2rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 32px;
        text-align: center;
      }

      /* Package Selection */
      .package-options {
        display: grid;
        gap: 20px;
        margin-bottom: 40px;
      }

      .package-option {
        position: relative;
      }

      .package-option input[type="radio"] {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .package-card {
        display: block;
        padding: 24px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
      }

      .package-card:hover {
        border-color: #3b82f6;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
      }

      .package-option input[type="radio"]:checked + .package-card {
        border-color: #3b82f6;
        background: #f0f9ff;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
      }

      .package-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .package-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
      }

      .package-price {
        font-size: 1.5rem;
        font-weight: 700;
        color: #3b82f6;
      }

      .package-description {
        color: #6b7280;
        margin-bottom: 16px;
      }

      .hours-selection {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
        display: none;
      }

      .package-notes {
        margin-top: 16px;
        padding: 12px;
        background: #f9fafb;
        border-radius: 6px;
      }

      .package-notes small {
        display: block;
        color: #6b7280;
        margin-bottom: 4px;
      }

      /* Form Sections */
      .form-section {
        margin-bottom: 40px;
        padding: 24px;
        background: #f9fafb;
        border-radius: 12px;
      }

      .form-section-title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 24px;
      }

      .form-section-title i {
        color: #3b82f6;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        margin-top: 10px;
      }

      .form-label {
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .form-input,
      .form-select,
      .form-textarea {
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .form-help {
        font-size: 12px;
        color: #6b7280;
        margin-top: 4px;
      }

      /* Radio and Checkbox Options */
      .radio-option,
      .checkbox-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 12px;
      }

      .radio-option:hover,
      .checkbox-item:hover {
        border-color: #3b82f6;
      }

      .radio-option input[type="radio"],
      .checkbox-item input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .radio-custom,
      .checkmark {
        width: 20px;
        height: 20px;
        border: 2px solid #d1d5db;
        position: relative;
        flex-shrink: 0;
        transition: all 0.3s ease;
      }

      .radio-custom {
        border-radius: 50%;
      }

      .checkmark {
        border-radius: 4px;
      }

      .radio-option:hover .radio-custom,
      .checkbox-item:hover .checkmark {
        border-color: #3b82f6;
      }

      .radio-option input[type="radio"]:checked ~ .radio-custom {
        border-color: #3b82f6;
      }

      .radio-option input[type="radio"]:checked ~ .radio-custom::after {
        content: "";
        width: 8px;
        height: 8px;
        background: #3b82f6;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .checkbox-item input[type="checkbox"]:checked ~ .checkmark {
        background: #3b82f6;
        border-color: #3b82f6;
      }

      .checkbox-item input[type="checkbox"]:checked ~ .checkmark::after {
        content: "✓";
        color: white;
        font-size: 12px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .radio-content strong {
        display: block;
        margin-bottom: 4px;
        color: #1f2937;
      }

      .radio-content p {
        font-size: 14px;
        color: #6b7280;
        margin: 0;
      }

      /* Form Actions */
      .form-actions {
        display: flex;
        justify-content: space-between;
        gap: 16px;
        margin-top: 40px;
      }

      /* Back Link */
      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: #6b7280;
        text-decoration: none;
        margin-bottom: 24px;
        font-size: 14px;
        transition: color 0.3s ease;
      }

      .back-link:hover {
        color: #3b82f6;
      }

      /* Summary Styles */
      .booking-summary {
        display: grid;
        gap: 24px;
        margin-bottom: 32px;
      }

      .summary-card {
        background: #f9fafb;
        border-radius: 12px;
        padding: 24px;
        border: 1px solid #e5e7eb;
      }

      .summary-card h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .summary-card h3 i {
        color: #3b82f6;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e5e7eb;
      }

      .summary-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .summary-label {
        font-weight: 500;
        color: #6b7280;
        flex-shrink: 0;
        margin-right: 16px;
      }

      .summary-value {
        color: #1f2937;
        text-align: right;
        flex: 1;
        word-break: break-word;
      }

      .summary-item.total {
        font-size: 1.25rem;
        font-weight: 600;
        border-top: 2px solid #3b82f6;
        padding-top: 16px;
        margin-top: 16px;
      }

      .summary-item.total .summary-value {
        color: #3b82f6;
      }

      .summary-divider {
        height: 1px;
        background: #e5e7eb;
        margin: 16px 0;
      }

      .cost-note {
        font-size: 12px;
        color: #6b7280;
        font-style: italic;
        margin-top: 8px;
      }

      /* Modal Styles */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background: white;
        border-radius: 16px;
        padding: 40px;
        max-width: 500px;
        text-align: center;
        margin: 20px;
      }

      .success-icon {
        font-size: 4rem;
        color: #10b981;
        margin-bottom: 20px;
      }

      .booking-reference {
        background: #f0f9ff;
        padding: 16px;
        border-radius: 8px;
        margin: 20px 0;
        border: 1px solid #bfdbfe;
      }

      .modal-actions {
        display: flex;
        gap: 16px;
        justify-content: center;
        margin-top: 24px;
      }

      /* Flatpickr Custom Styling */
      .flatpickr-calendar {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
        border: 1px solid #e5e7eb !important;
      }

      .flatpickr-day.selected {
        background: #ef4444 !important;
        border-color: #ef4444 !important;
      }

      .flatpickr-day.selected:hover {
        background: #dc2626 !important;
        border-color: #dc2626 !important;
      }

      .flatpickr-day:hover {
        background: #fef2f2 !important;
        border-color: #ef4444 !important;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .booking__title {
          font-size: 2rem;
        }

        .booking-form {
          padding: 24px;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .form-actions {
          flex-direction: column;
        }

        .service-header {
          flex-direction: column;
          text-align: center;
          align-items: center;
        }

        .service-icon {
          margin-bottom: 16px;
        }

        .progress-steps {
          margin: 30px 0 40px 0;
          gap: 40px;
        }

        .step__number {
          width: 40px;
          height: 40px;
          font-size: 16px;
        }

        .step__label {
          font-size: 12px;
        }

        .package-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .summary-item {
          flex-direction: column;
          align-items: flex-start;
          gap: 4px;
        }

        .summary-value {
          text-align: left;
        }
      }

      .text-center {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- Header Component -->
    <div id="header-placeholder"></div>

    <!-- Booking Section -->
    <section class="booking-section">
      <div class="container">
        <a href="booking.html" class="back-link">
          <i class="fas fa-arrow-left"></i>
          Back to Services
        </a>

        <div class="booking__header text-center">
          <h1 class="booking__title">Health Appointment Support</h1>
          <p class="booking__subtitle">
            Professional assistance for medical checkups and treatments with
            caring companionship
          </p>
        </div>

        <!-- Service Information Card -->
        <div class="service-info-card">
          <div class="service-header">
            <div class="service-icon">
              <i class="fas fa-stethoscope"></i>
            </div>
            <h2>TEMAN Health Appointments</h2>
          </div>
          <p>
            Experience a comprehensive companion service to your health
            appointments - from your doorstep until you return. Suitable for
            medical appointments, treatments or therapy sessions.
          </p>

          <div class="service-features">
            <div class="feature-item">
              <i class="fas fa-check"></i>
              <strong>Physical assistance</strong>
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              <strong>Transportation & mobility</strong>
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              <strong>Administrative support</strong>
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              <strong>Communication between family & providers</strong>
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              <strong>Emotional & social support</strong>
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              <strong>Post-appointment care</strong>
            </div>
          </div>
        </div>

        <div class="booking__container">
          <!-- Progress Steps -->
          <div class="progress-steps" id="progressSteps">
            <div class="step active" data-step="1">
              <div class="step__number">1</div>
              <div class="step__label">Package</div>
            </div>
            <div class="step" data-step="2">
              <div class="step__number">2</div>
              <div class="step__label">Details</div>
            </div>
            <div class="step" data-step="3">
              <div class="step__number">3</div>
              <div class="step__label">Payment</div>
            </div>
          </div>

          <!-- Booking Form -->
          <form
            id="health-booking-form"
            class="booking-form"
            data-form-type="health-appointments"
            action="https://formspree.io/f/xnnzgblw"
            method="POST"
          >
            <!-- Step 1: Package Selection -->
            <div class="form-step active" data-step="1">
              <h2 class="step-title">Choose Your Package</h2>

              <div class="package-options">
                <!-- Hourly Rate Package -->
                <div class="package-option">
                  <input
                    type="radio"
                    name="package"
                    value="hourly"
                    id="hourly-package"
                    required
                  />
                  <label for="hourly-package" class="package-card">
                    <div class="package-header">
                      <div class="package-title">Hourly Rate</div>
                      <div class="package-price">RM35/hour</div>
                    </div>
                    <div class="package-description">
                      Choose the number of hours for service, as needed. Minimum
                      2 hours booking
                    </div>

                    <div class="hours-selection">
                      <label for="hours" class="form-label"
                        >Number of Hours: *</label
                      >
                      <select
                        name="hours"
                        id="hours"
                        class="form-select"
                        required
                      >
                        <option value="">Select hours</option>
                        <option value="2">2 hours - RM70</option>
                        <option value="3">3 hours - RM105</option>
                        <option value="4">4 hours - RM140</option>
                        <option value="5">5 hours - RM175</option>
                        <option value="6">6 hours - RM210</option>
                        <option value="" disabled>
                          More than 6 hours (Contact us)
                        </option>
                      </select>
                    </div>
                  </label>
                </div>

                <!-- Package 1: 4 Hours -->
                <div class="package-option">
                  <input
                    type="radio"
                    name="package"
                    value="package1"
                    id="package1"
                    required
                  />
                  <label for="package1" class="package-card">
                    <div class="package-header">
                      <div class="package-title">4 Hours</div>
                      <div class="package-price">
                        RM132 <small>(RM33/hour)</small>
                      </div>
                    </div>
                    <div class="package-description">
                      Suitable for shorter appointment
                      sessions.
                    </div>
                  </label>
                </div>

                <!-- Package 2: 6 Hours -->
                <div class="package-option">
                  <input
                    type="radio"
                    name="package"
                    value="package2"
                    id="package2"
                    required
                  />
                  <label for="package2" class="package-card">
                    <div class="package-header">
                      <div class="package-title">6 Hours</div>
                      <div class="package-price">
                        RM186 <small>(RM31/hour)</small>
                      </div>
                    </div>
                    <div class="package-description">
                      Suitable for longer appointment sessions, or short
                      appointments with extended activities (eg: meals, errands,
                      etc.)
                    </div>
                  </label>
                </div>
              </div>

              <div
                style="
                  background: #fffbeb;
                  padding: 16px;
                  border-radius: 8px;
                  margin-bottom: 32px;
                  border-left: 4px solid #f59e0b;
                "
              >
                <h4 style="color: #d97706; margin-bottom: 8px">
                  Additional Fees & Information:
                </h4>
                <small
                  style="display: block; color: #d97706; margin-bottom: 4px"
                  >• Surcharge: RM37/hour for services on Public Holiday /
                  Sundays / from last-minute bookings (<24 hours)</small
                >
                <small style="display: block; color: #d97706"
                  >• For service longer than 6 hours, bulk purchase or
                  customization - contact us for quote</small
                >
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn--primary btn--large"
                  onclick="nextStep()"
                >
                  Continue to Details<i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>

            <!-- Step 2: Personal Details -->
            <div class="form-step" data-step="2">
              <h2 class="step-title">Booking Details</h2>

              <!-- Contact Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-user"></i>
                  Contact Information
                </h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="full-name" class="form-label"
                      >Full Name *</label
                    >
                    <input
                      type="text"
                      id="full-name"
                      name="full_name"
                      class="form-input"
                      placeholder="Enter your full name"
                      required
                    />
                  </div>

                  <div class="form-group">
                    <label for="ic-number" class="form-label"
                      >IC Number</label
                    >
                    <input
                      type="text"
                      id="ic-number"
                      name="ic_number"
                      class="form-input"
                      placeholder="123456-12-1234"
                      pattern="[0-9]{6}-[0-9]{2}-[0-9]{4}"
                      title="Please enter IC number in format: 123456-12-1234"
                      required
                    />
                  </div>

                  <div class="form-group">
                    <label for="relationship" class="form-label"
                      >Relationship to Care Recipient</label
                    >
                    <select
                      id="relationship"
                      name="relationship"
                      class="form-select"
                    >
                      <option value="">Select relationship</option>
                      <option value="self">Self</option>
                      <option value="spouse">Spouse</option>
                      <option value="child">Son/Daughter</option>
                      <option value="parent">Parent</option>
                      <option value="sibling">Brother/Sister</option>
                      <option value="relative">Other Relative</option>
                      <option value="caregiver">Professional Caregiver</option>
                      <option value="friend">Friend</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="phone" class="form-label">Phone Number *</label>
                    <input
                      type="tel"
                      id="phone"
                      name="phone"
                      class="form-input"
                      placeholder="+60 11-234 5678"
                      required
                    />
                  </div>

                  <div class="form-group">
                    <label for="email" class="form-label"
                      >Email Address *</label
                    >
                    <input
                      type="email"
                      id="email"
                      name="email"
                      class="form-input"
                      placeholder="your.email@example.com"
                      required
                    />
                    <small class="form-help"
                      >Use company email if claiming staff benefit</small
                    >
                  </div>

                  <div class="form-group">
                    <label for="employer" class="form-label"
                      >Employer Name</label
                    >
                    <input
                      type="text"
                      id="employer"
                      name="employer"
                      class="form-input"
                      placeholder="Your company name"
                    />
                    <small class="form-help"
                      >For Staff Benefit claims only</small
                    >
                  </div>

                  <div class="form-group">
                    <label for="staff_id" class="form-label">Staff ID</label>
                    <input
                      type="text"
                      id="staff_id"
                      name="staff_id"
                      class="form-input"
                      placeholder="Your employee ID"
                    />
                    <small class="form-help"
                      >For Staff Benefit claims only</small
                    >
                  </div>
                </div>

                <div class="form-group">
                  <label for="emergency-contact" class="form-label"
                    >Emergency Contact Person *</label
                  >
                  <input
                    type="text"
                    id="emergency-contact"
                    name="emergency_contact"
                    class="form-input"
                    placeholder="Name and phone number of emergency contact"
                    required
                  />
                </div>
              </div>

              <!-- Care Recipient Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-heart-pulse"></i>
                  Care Recipient Information
                </h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="patient-name" class="form-label"
                      >Care Recipient Name</label
                    >
                    <input
                      type="text"
                      id="patient-name"
                      name="patient_name"
                      class="form-input"
                      placeholder="If different from contact person"
                    />
                  </div>

                  <div class="form-group">
                    <label for="patient-age" class="form-label"
                      >Care Recipient Age</label
                    >
                    <input
                      type="number"
                      id="patient-age"
                      name="patient_age"
                      class="form-input"
                      min="1"
                      max="120"
                      placeholder="Age in years"
                    />
                  </div>

                  <div class="form-group">
                    <label for="patient-gender" class="form-label"
                      >Gender</label
                    >
                    <select
                      id="patient-gender"
                      name="patient_gender"
                      class="form-select"
                    >
                      <option value="">Select gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="patient-language" class="form-label"
                      >Preferred Language</label
                    >
                    <select
                      id="patient-language"
                      name="patient_language"
                      class="form-select"
                    >
                      <option value="english">English</option>
                      <option value="bahasa">Bahasa Malaysia</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="patient-weight" class="form-label"
                      >Care Recipient Weight</label
                    >
                    <input
                      type="number"
                      id="patient-weight"
                      name="patient_weight"
                      class="form-input"
                      placeholder="Weight in kg"
                    />
                  </div>

                  <div class="form-group">
                    <label for="patient-height" class="form-label"
                      >Care Recipient Height</label
                    >
                    <input
                      type="number"
                      id="patient-height"
                      name="patient_height"
                      class="form-input"
                      placeholder="Height in cm"
                    />
                  </div>
                </div>
              </div>

              <!-- Appointment Details -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-calendar-alt"></i>
                  Appointment Details
                </h3>

                <!-- Multi-date calendar -->
                <div class="form-group">
                  <label for="appointment-dates" class="form-label"
                    >Select Appointment Date *</label
                  >
                  <input
                    type="text"
                    id="appointment-dates"
                    name="appointment_dates"
                    class="form-input"
                    placeholder="Select appointment date"
                    readonly
                    required
                  />
                  <small class="form-help"
                    >Select a specific date; today and tomorrow are
                    disabled</small
                  >
                  <div
                    id="appointment-date-count"
                    style="
                      color: #666;
                      margin-top: 5px;
                      font-size: 0.875rem;
                      display: none;
                    "
                  >
                    Selected date: <span id="appointment-selected-count"></span>
                  </div>
                  <div
                    id="appointment-hours-info"
                    style="
                      color: #ef4444;
                      margin-top: 5px;
                      font-size: 0.875rem;
                      font-weight: 500;
                    "
                  >
                    Please select a package in Step 1 first to enable date
                    selection
                  </div>
                </div>

                <!-- 30-Day Validity Disclaimer -->
                <div
                  style="
                    background: #fef2f2;
                    border: 2px dashed #dc2626;
                    border-radius: 12px;
                    padding: 16px;
                    margin: 20px 0;
                  "
                >
                  <h4
                    style="
                      color: #dc2626;
                      margin-bottom: 8px;
                      display: flex;
                      align-items: center;
                      gap: 8px;
                    "
                  >
                    <i class="fas fa-exclamation-triangle"></i>
                    Important: Validity Period
                  </h4>
                  <p style="color: #dc2626; font-size: 14px; margin: 0">
                    <strong
                      >All unused hours are only valid for 30 days after
                      booking.</strong
                    >
                    Please plan your appointment dates within this period to
                    avoid forfeiture of unused hours.
                  </p>
                </div>

                <div class="form-grid">
                  <div class="form-group">
                    <label for="appointment-type" class="form-label"
                      >Type of Medical Appointment *</label
                    >
                    <select
                      id="appointment-type"
                      name="appointment_type"
                      class="form-select"
                      required
                    >
                      <option value="">Select appointment type</option>
                      <option value="general-checkup">
                        General Health Checkup
                      </option>
                      <option value="specialist">
                        Specialist Consultation
                      </option>
                      <option value="diagnostic">
                        Diagnostic Tests/Screening
                      </option>
                      <option value="treatment">Medical Treatment</option>
                      <option value="therapy">
                        Physical/Occupational Therapy
                      </option>
                      <option value="dental">Dental Appointment</option>
                      <option value="eye-care">Eye Care/Optometry</option>
                      <option value="mental-health">
                        Mental Health/Counseling
                      </option>
                      <option value="vaccination">Vaccination</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="doctor-name" class="form-label"
                      >Doctor/Specialist Name</label
                    >
                    <input
                      type="text"
                      id="doctor-name"
                      name="doctor_name"
                      class="form-input"
                      placeholder="Dr. Name (if known)"
                    />
                  </div>

                  <div class="form-group">
                    <label for="appointment-time" class="form-label"
                      >Preferred Appointment Time *</label
                    >
                    <input
                      type="time"
                      id="appointment-time"
                      name="appointment_time"
                      class="form-input"
                      required
                    />
                  </div>

                  <div class="form-group">
                    <label for="estimated-duration" class="form-label"
                      >Estimated Duration</label
                    >
                    <select
                      id="estimated-duration"
                      name="estimated_duration"
                      class="form-select"
                    >
                      <option value="">Select duration</option>
                      <option value="30min">30 minutes</option>
                      <option value="1hour">1 hour</option>
                      <option value="1.5hours">1.5 hours</option>
                      <option value="2hours">2 hours</option>
                      <option value="3hours">3 hours</option>
                      <option value="4hours">4+ hours</option>
                      <option value="unknown">Unknown</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Location Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-map-marker-alt"></i>
                  Location Details
                </h3>
                <div class="form-group">
                  <label for="facility-address" class="form-label"
                    >Medical Facility Address *</label
                  >
                  <textarea
                    id="facility-address"
                    name="facility_address"
                    class="form-textarea"
                    rows="3"
                    placeholder="Complete address of the medical facility"
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="pickup-address" class="form-label"
                    >Pickup Address *</label
                  >
                  <textarea
                    id="pickup-address"
                    name="pickup_address"
                    class="form-textarea"
                    rows="3"
                    placeholder="Address where our Temanion should meet you"
                    required
                  ></textarea>
                </div>

                <div class="form-grid">
                  <div class="form-group">
                    <label for="pickup-time" class="form-label"
                      >Preferred Pickup Time *</label
                    >
                    <input
                      type="time"
                      id="pickup-time"
                      name="pickup_time"
                      class="form-input"
                      required
                    />
                    <small class="form-help"
                      >We recommend 30 - 60 minutes before appointment time,
                      allowing for travel distance and traffic</small
                    >
                  </div>

                  <div class="form-group">
                    <label for="return-address" class="form-label"
                      >Return Address</label
                    >
                    <input
                      type="text"
                      id="return-address"
                      name="return_address"
                      class="form-input"
                      placeholder="If different from pickup address"
                    />
                  </div>
                </div>
              </div>

              <!-- Transportation -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-car"></i>
                  Transportation for Activities
                </h3>
                <div style="display: grid; gap: 12px">
                  <label class="radio-option">
                    <input
                      type="radio"
                      name="transportation_mode"
                      value="client-provided"
                      required
                    />
                    <span class="radio-custom"></span>
                    <div class="radio-content">
                      <strong>I will provide transportation</strong>
                      <div class="package-description">No charges</div>
                    </div>
                  </label>

                  <label class="radio-option">
                    <input
                      type="radio"
                      name="transportation_mode"
                      value="teman-provided"
                      required
                    />
                    <span class="radio-custom"></span>
                    <div class="radio-content">
                      <strong>Temanion will arrange transportation</strong>
                      <div class="package-description">
                        Transportation fee of RM0.80/KM applies
                      </div>
                    </div>
                  </label>

                  <label class="radio-option">
                    <input
                      type="radio"
                      name="transportation_mode"
                      value="e-hailing"
                      required
                    />
                    <span class="radio-custom"></span>
                    <div class="radio-content">
                      <strong>E-Hailing Service (Grab/Taxi)</strong>
                      <div class="package-description">
                        Exact fare charged applies
                      </div>
                    </div>
                  </label>
                </div>

                <div class="form-group" style="margin-top: 16px">
                  <label for="transportation-notes" class="form-label"
                    >Transportation Notes</label
                  >
                  <textarea
                    id="transportation-notes"
                    name="transportation_notes"
                    class="form-textarea"
                    rows="2"
                    placeholder="Any specific transportation preferences, accessibility needs, or special instructions..."
                  ></textarea>
                </div>
              </div>

              <!-- Medical Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-notes-medical"></i>
                  Medical & Care Information
                </h3>

                <div class="form-group">
                  <label for="medical-conditions" class="form-label"
                    >Medical Conditions *</label
                  >
                  <textarea
                    id="medical-conditions"
                    name="medical_conditions"
                    class="form-textarea"
                    rows="3"
                    placeholder="Please list any medical conditions, disabilities, or health concerns that our companion should be aware of..."
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="medications" class="form-label"
                    >Current Medications</label
                  >
                  <textarea
                    id="medications"
                    name="medications"
                    class="form-textarea"
                    rows="2"
                    placeholder="List current medications and any reminders needed..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="mobility-assistance" class="form-label"
                    >Mobility Assistance Needed *</label
                  >
                  <select
                    id="mobility-assistance"
                    name="mobility_assistance"
                    class="form-select"
                    required
                  >
                    <option value="">Select mobility assistance</option>
                    <option value="none">None</option>
                    <option value="wheelchair">Wheelchair assistance</option>
                    <option value="walker">Walker/walking aid</option>
                    <option value="walking">Walking assistance</option>
                    <option value="other">Other</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="special-requirements" class="form-label"
                    >Special Requirements *</label
                  >
                  <textarea
                    id="special-requirements"
                    name="special_requirements"
                    class="form-textarea"
                    rows="3"
                    placeholder="Any specific assistance needed, allergies, dietary restrictions, or other important information..."
                    required
                  ></textarea>
                </div>
              </div>

              <!-- Additional Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-comment-dots"></i>
                  Additional Information
                </h3>

                <div class="form-group">
                  <label for="companion-preferences" class="form-label"
                    >Companion Preferences</label
                  >
                  <div class="form-grid">
                    <div class="form-group">
                      <label for="companion-gender" class="form-label"
                        >Preferred Gender</label
                      >
                      <select
                        id="companion-gender"
                        name="companion_gender"
                        class="form-select"
                      >
                        <option value="no-preference">No preference</option>
                        <option value="female">Female</option>
                        <option value="male">Male</option>
                      </select>
                    </div>

                    <div class="form-group">
                      <label for="companion-language" class="form-label"
                        >Language Preference</label
                      >
                      <select
                        id="companion-language"
                        name="companion_language"
                        class="form-select"
                      >
                        <option value="english">English</option>
                        <option value="bahasa">Bahasa Malaysia</option>
                        <option value="other">Other</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="form-group">
                  <label for="additional-notes" class="form-label"
                    >Additional Notes</label
                  >
                  <textarea
                    id="additional-notes"
                    name="additional_notes"
                    class="form-textarea"
                    rows="4"
                    placeholder="Any other information, special requests, or concerns you'd like us to know about..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="how-heard" class="form-label"
                    >How did you hear about us? *</label
                  >
                  <select
                    id="how-heard"
                    name="how_heard"
                    class="form-select"
                    required
                  >
                    <option value="">Please select an option</option>
                    <option value="google">Google Search</option>
                    <option value="facebook">Facebook</option>
                    <option value="instagram">Instagram</option>
                    <option value="friend">Friend/Family Referral</option>
                    <option value="doctor">Doctor/Medical Professional</option>
                    <option value="hospital">Hospital/Clinic</option>
                    <option value="newspaper">Newspaper/Magazine</option>
                    <option value="radio">Radio</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn--outline btn--large"
                  onclick="prevStep()"
                >
                  <i class="fas fa-arrow-left"></i>
                  Previous
                </button>
                <button
                  type="button"
                  class="btn btn--primary btn--large"
                  onclick="nextStep()"
                >
                  Review & Pay
                  <i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>
            <!-- Step 3: Payment & Confirmation -->
            <div class="form-step" data-step="3">
              <h2 class="step-title">Booking Summary & Payment</h2>

              <div class="booking-summary">
                <div class="summary-card">
                  <h3><i class="fas fa-clipboard-list"></i> Service Details</h3>
                  <div class="summary-item">
                    <span class="summary-label">Service:</span>
                    <span class="summary-value"
                      >Health Appointment Support</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Package:</span>
                    <span class="summary-value" id="summary-package">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Appointment Dates:</span>
                    <span class="summary-value" id="summary-appointment-dates"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Appointment Type:</span>
                    <span class="summary-value" id="summary-appointment-type"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Appointment Time:</span>
                    <span class="summary-value" id="summary-appointment-time"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Doctor/Specialist:</span>
                    <span class="summary-value" id="summary-doctor">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Medical Facility:</span>
                    <span class="summary-value" id="summary-facility">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Transportation:</span>
                    <span class="summary-value" id="summary-transportation"
                      >-</span
                    >
                  </div>
                  <div class="summary-divider"></div>
                  <div class="summary-item total">
                    <span class="summary-label">Package Cost:</span>
                    <span class="summary-value" id="summary-total">RM 0</span>
                  </div>
                  <p class="cost-note">
                    *Final cost may vary based on additional services,
                    transportation fees and allowance
                  </p>
                </div>

                <div class="summary-card">
                  <h3><i class="fas fa-user"></i> Contact Information</h3>
                  <div class="summary-item">
                    <span class="summary-label">Name:</span>
                    <span class="summary-value" id="summary-name">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">IC Number:</span>
                    <span class="summary-value" id="summary-ic-number">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Phone:</span>
                    <span class="summary-value" id="summary-phone">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Email:</span>
                    <span class="summary-value" id="summary-email">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Relationship:</span>
                    <span class="summary-value" id="summary-relationship"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Emergency Contact:</span>
                    <span class="summary-value" id="summary-emergency">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Employer:</span>
                    <span class="summary-value" id="summary-employer">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Staff ID:</span>
                    <span class="summary-value" id="summary-staff-id">-</span>
                  </div>
                </div>

                <div class="summary-card">
                  <h3>
                    <i class="fas fa-heart-pulse"></i> Care Recipient Details
                  </h3>
                  <div class="summary-item">
                    <span class="summary-label">Name:</span>
                    <span class="summary-value" id="summary-patient-name"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Age:</span>
                    <span class="summary-value" id="summary-patient-age"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Gender:</span>
                    <span class="summary-value" id="summary-patient-gender"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Preferred Language:</span>
                    <span class="summary-value" id="summary-patient-language"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Weight:</span>
                    <span class="summary-value" id="summary-patient-weight"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Height:</span>
                    <span class="summary-value" id="summary-patient-height"
                      >-</span
                    >
                  </div>
                </div>

                <div class="summary-card">
                  <h3>
                    <i class="fas fa-map-marker-alt"></i> Location Details
                  </h3>
                  <div class="summary-item">
                    <span class="summary-label">Pickup Address:</span>
                    <span class="summary-value" id="summary-pickup">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Pickup Time:</span>
                    <span class="summary-value" id="summary-pickup-time"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Return Address:</span>
                    <span class="summary-value" id="summary-return">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Transportation Notes:</span>
                    <span
                      class="summary-value"
                      id="summary-transportation-notes"
                      >-</span
                    >
                  </div>
                </div>

                <div class="summary-card">
                  <h3>
                    <i class="fas fa-notes-medical"></i> Medical Information
                  </h3>
                  <div class="summary-item">
                    <span class="summary-label">Medical Conditions:</span>
                    <span class="summary-value" id="summary-medical-conditions"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Current Medications:</span>
                    <span class="summary-value" id="summary-medications"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Mobility Assistance:</span>
                    <span class="summary-value" id="summary-mobility">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Special Requirements:</span>
                    <span
                      class="summary-value"
                      id="summary-special-requirements"
                      >-</span
                    >
                  </div>
                </div>

                <div class="summary-card">
                  <h3>
                    <i class="fas fa-user-friends"></i> Companion Preferences
                  </h3>
                  <div class="summary-item">
                    <span class="summary-label">Preferred Gender:</span>
                    <span class="summary-value" id="summary-companion-gender"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Language Preference:</span>
                    <span class="summary-value" id="summary-companion-language"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Additional Notes:</span>
                    <span class="summary-value" id="summary-additional-notes"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label"
                      >How did you hear about us:</span
                    >
                    <span class="summary-value" id="summary-how-heard">-</span>
                  </div>
                </div>
              </div>

              <div
                style="
                  background: #f0f9ff;
                  border: 1px solid #bfdbfe;
                  border-radius: 12px;
                  padding: 24px;
                  margin-bottom: 32px;
                "
              >
                <h3
                  style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    color: #1e40af;
                    margin-bottom: 16px;
                  "
                >
                  <i class="fas fa-info-circle"></i> What Happens Next?
                </h3>
                <ul style="list-style: none; padding: 0">
                  <li
                    style="
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      margin-bottom: 12px;
                      color: #1e40af;
                    "
                  >
                    <i
                      class="fas fa-credit-card"
                      style="width: 20px; text-align: center"
                    ></i>
                    Complete your deposit payment to secure your booking
                  </li>
                  <li
                    style="
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      margin-bottom: 12px;
                      color: #1e40af;
                    "
                  >
                    <i
                      class="fas fa-phone"
                      style="width: 20px; text-align: center"
                    ></i>
                    Our team will contact you within 24 hours to confirm details
                  </li>
                  <li
                    style="
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      margin-bottom: 12px;
                      color: #1e40af;
                    "
                  >
                    <i
                      class="fas fa-user-check"
                      style="width: 20px; text-align: center"
                    ></i>
                    We will assign a suitable Temanion based on your
                    requirements
                  </li>
                  <li
                    style="
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      color: #1e40af;
                    "
                  >
                    <i
                      class="fas fa-heart"
                      style="width: 20px; text-align: center"
                    ></i>
                    Your companion will arrive at the scheduled time
                  </li>
                </ul>
              </div>

              <div style="margin-bottom: 32px">
                <label
                  class="checkbox-item"
                  style="
                    margin-bottom: 0;
                    padding: 16px;
                    border: 1px solid #d1d5db;
                    border-radius: 8px;
                    cursor: pointer;
                  "
                >
                  <input type="checkbox" name="terms_agreed" required />
                  <span class="checkmark"></span>
                  <span style="font-size: 14px; color: #374151">
                    I agree to the
                    <a href="terms.html" style="color: #3b82f6; text-decoration: none"
                      >Terms & Conditions</a
                    >
                    and
                    <a href="privacy.html" style="color: #3b82f6; text-decoration: none"
                      >Privacy Policy</a
                    >
                    *
                  </span>
                </label>
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn--outline btn--large"
                  onclick="prevStep()"
                >
                  <i class="fas fa-arrow-left"></i>
                  Previous
                </button>
                <a
                  href="https://www.billplz.com/deposit4Teman"
                  target="_blank"
                  class="btn btn--payment btn--large"
                  id="pay-deposit-btn"
                >
                  <i class="fas fa-credit-card"></i>
                  Pay Deposit
                </a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Success Modal -->
    <div id="booking-success-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>Booking Request Submitted!</h2>
        <p>
          Thank you for choosing Teman Malaysia for your Health Appointments
          support. We've received your booking request and will contact you
          within 24 hours to confirm the details.
        </p>
        <p>
          To complete your deposit payment, please proceed to our secure payment
          gateway:
          <a
            href="https://www.billplz.com/deposit4Teman"
            target="_blank"
            rel="noopener noreferrer"
            style="color: blue;"
          >
            Click here to make your payment
          </a>
        </p>

        <div class="booking-reference">
          <strong
            >Reference Number: <span id="booking-ref-number"></span
          ></strong>
        </div>
        <div class="modal-actions">
          <button
            class="btn btn--primary"
            onclick="window.location.href='booking.html'"
          >
            Book Another Service
          </button>
          <button class="btn btn--outline" onclick="closeModal()">Close</button>
        </div>
      </div>
    </div>

    <!-- Footer Component -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
      // Current step tracking
      let currentStep = 1;
      const totalSteps = 3;

      // Flatpickr instance
      let appointmentFp = null;

      // Utility: format date as YYYY-MM-DD
      function formatDate(date) {
        return date.toISOString().split("T")[0];
      }

      // Calculate date boundaries
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(today.getDate() + 1);
      const dayAfterTomorrow = new Date(today);
      dayAfterTomorrow.setDate(today.getDate() + 2);

      const minDateStr = formatDate(dayAfterTomorrow);

      // Get DOM elements
      const appointmentCountEl = document.getElementById(
        "appointment-selected-count"
      );
      const appointmentHoursInfoEl = document.getElementById(
        "appointment-hours-info"
      );
      const appointmentDatesInput =
        document.getElementById("appointment-dates");
      const appointmentDateCountDiv = document.getElementById(
        "appointment-date-count"
      );

      // Function to update display based on selected package
      function calculateMaxAppointments() {
        const selectedPackage = document.querySelector(
          'input[name="package"]:checked'
        );

        if (!selectedPackage) {
          appointmentHoursInfoEl.textContent =
            "Please select a package in Step 1 first to enable date selection";
          appointmentHoursInfoEl.style.color = "#ef4444";
          appointmentDatesInput.disabled = true;
          if (appointmentFp) appointmentFp.set("disabled", true);
          if (appointmentDateCountDiv)
            appointmentDateCountDiv.style.display = "none";
          return;
        }

        let totalHours = 0;
        let packageText = "";

        if (selectedPackage.value === "hourly") {
          const hoursSelect = document.getElementById("hours");
          if (
            hoursSelect &&
            hoursSelect.value &&
            hoursSelect.value !== "custom"
          ) {
            totalHours = parseInt(hoursSelect.value) || 0;
            packageText = `${totalHours} hours selected`;
          } else if (hoursSelect.value === "custom") {
            appointmentHoursInfoEl.textContent =
              "Please contact us for custom hour arrangements";
            appointmentHoursInfoEl.style.color = "#f59e0b";
            appointmentDatesInput.disabled = true;
            if (appointmentFp) appointmentFp.set("disabled", true);
            if (appointmentDateCountDiv)
              appointmentDateCountDiv.style.display = "none";
            return;
          }
        } else if (selectedPackage.value === "package1") {
          totalHours = 4;
          packageText = "Package 1 (4 hours)";
        } else if (selectedPackage.value === "package2") {
          totalHours = 6;
          packageText = "Package 2 (6 hours)";
        }

        if (totalHours > 0) {
          appointmentHoursInfoEl.textContent = `${packageText} - Select your appointment date`;
          appointmentHoursInfoEl.style.color = "#10b981";

          appointmentDatesInput.disabled = false;
          if (appointmentFp) {
            appointmentFp.set("disabled", false);
          }
        } else {
          if (selectedPackage.value === "hourly") {
            appointmentHoursInfoEl.textContent =
              "Please select hours to enable date selection";
          } else {
            appointmentHoursInfoEl.textContent =
              "Please select a package to enable date selection";
          }
          appointmentHoursInfoEl.style.color = "#ef4444";
          appointmentDatesInput.disabled = true;
          if (appointmentFp) appointmentFp.set("disabled", true);
          if (appointmentDateCountDiv)
            appointmentDateCountDiv.style.display = "none";
        }

        updateAppointmentDateSelection(
          appointmentFp ? appointmentFp.selectedDates : [],
          appointmentFp
        );
      }

      // Initialize Flatpickr for appointments - SINGLE DATE MODE
      function initializeAppointmentFlatpickr() {
        appointmentFp = flatpickr("#appointment-dates", {
          mode: "single", // Changed from "multiple" to "single"
          dateFormat: "Y-m-d",
          disable: [formatDate(today), formatDate(tomorrow)],
          minDate: minDateStr,
          disabled: true,
          onChange: function (selectedDates, dateStr, instance) {
            updateAppointmentDateSelection(selectedDates, instance);
          },
          onReady: function (selectedDates, dateStr, instance) {
            updateAppointmentDateSelection(selectedDates, instance);
          },
        });
      }

      // Update appointment date selection display
      function updateAppointmentDateSelection(selectedDates, instance) {
        if (!instance || !appointmentDateCountDiv) return;

        const count = selectedDates.length;

        if (count > 0) {
          appointmentCountEl.textContent = formatDate(selectedDates[0]);
          appointmentDateCountDiv.style.display = "block";
        } else {
          appointmentDateCountDiv.style.display = "none";
        }
      }

      // Add event listeners for package changes
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize flatpickr
        initializeAppointmentFlatpickr();

        // Listen for package changes
        const packageInputs = document.querySelectorAll(
          'input[name="package"]'
        );
        packageInputs.forEach((input) => {
          input.addEventListener("change", calculateMaxAppointments);
        });

        // Listen for hours changes
        const hoursSelect = document.getElementById("hours");
        if (hoursSelect) {
          hoursSelect.addEventListener("change", calculateMaxAppointments);
        }

        // Initial calculation
        calculateMaxAppointments();
      });

      // Update progress steps visual state
      function updateProgressSteps() {
        const steps = document.querySelectorAll(".step");

        steps.forEach((step, index) => {
          const stepNumber = index + 1;
          step.classList.remove("active", "completed");

          if (stepNumber < currentStep) {
            step.classList.add("completed");
          } else if (stepNumber === currentStep) {
            step.classList.add("active");
          }
        });
      }

      // Navigate to next step
      function nextStep() {
        if (currentStep < totalSteps) {
          if (validateCurrentStep()) {
            document
              .querySelector(`.form-step[data-step="${currentStep}"]`)
              .classList.remove("active");
            currentStep++;
            document
              .querySelector(`.form-step[data-step="${currentStep}"]`)
              .classList.add("active");
            updateProgressSteps();

            if (currentStep === 3) {
              updateBookingSummary();
            }

            window.scrollTo({ top: 0, behavior: "smooth" });
          }
        }
      }

      // Navigate to previous step
      function prevStep() {
        if (currentStep > 1) {
          document
            .querySelector(`.form-step[data-step="${currentStep}"]`)
            .classList.remove("active");
          currentStep--;
          document
            .querySelector(`.form-step[data-step="${currentStep}"]`)
            .classList.add("active");
          updateProgressSteps();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      }

      // Validate current step
      function validateCurrentStep() {
        if (currentStep === 1) {
          const packageSelected = document.querySelector(
            'input[name="package"]:checked'
          );
          if (!packageSelected) {
            alert("Please select a package before continuing.");
            return false;
          }

          if (
            packageSelected.value === "hourly" &&
            !document.getElementById("hours").value
          ) {
            alert("Please select the number of hours.");
            return false;
          }

          if (
            packageSelected.value === "hourly" &&
            document.getElementById("hours").value === "custom"
          ) {
            alert(
              "Please contact us for custom hour arrangements. We'll redirect you to our contact page."
            );
            // You can redirect to contact page here
            return false;
          }
        } else if (currentStep === 2) {
          const requiredFields = [
            { name: "full_name", label: "Full Name" },
            { name: "phone", label: "Phone Number" },
            { name: "email", label: "Email Address" },
            { name: "emergency_contact", label: "Emergency Contact" },
            { name: "appointment_dates", label: "Appointment Dates" },
            { name: "appointment_type", label: "Appointment Type" },
            { name: "appointment_time", label: "Appointment Time" },
            { name: "facility_address", label: "Medical Facility Address" },
            { name: "pickup_address", label: "Pickup Address" },
            { name: "pickup_time", label: "Pickup Time" },
            { name: "how_heard", label: "How did you hear about us?" },
            { name: "medical_conditions", label: "Medical Conditions" },
            {
              name: "mobility_assistance",
              label: "Mobility Assistance Needed",
            },
            { name: "special_requirements", label: "Special Requirements" },
          ];

          for (let field of requiredFields) {
            const element = document.querySelector(`[name="${field.name}"]`);
            if (!element || !element.value.trim()) {
              alert(`Please fill in the ${field.label} field.`);
              if (element) element.focus();
              return false;
            }
          }

          const transportationSelected = document.querySelector(
            'input[name="transportation_mode"]:checked'
          );
          if (!transportationSelected) {
            alert("Please select a transportation mode.");
            return false;
          }
        } else if (currentStep === 3) {
          const termsAgreed = document.querySelector(
            'input[name="terms_agreed"]:checked'
          );
          if (!termsAgreed) {
            alert(
              "Please agree to the Terms & Conditions and Privacy Policy to continue."
            );
            return false;
          }
        }
        return true;
      }

      // Helper function to format text
      function formatText(text) {
        if (!text) return "-";
        return text.replace(/-/g, " ").replace(/\b\w/g, (l) => l.toUpperCase());
      }

      // Update booking summary
      function updateBookingSummary() {
        // Package details
        const selectedPackage = document.querySelector(
          'input[name="package"]:checked'
        );
        if (selectedPackage) {
          let packageInfo = "";
          let estimatedCost = 0;

          if (selectedPackage.value === "hourly") {
            const hours = document.getElementById("hours").value;
            packageInfo = `Hourly Rate - ${hours} hours`;
            estimatedCost = hours * 35;
          } else if (selectedPackage.value === "package1") {
            packageInfo = "Package 1 (4 hours)";
            estimatedCost = 132;
          } else if (selectedPackage.value === "package2") {
            packageInfo = "Package 2 (6 hours)";
            estimatedCost = 186;
          }

          document.getElementById("summary-package").textContent = packageInfo;
          document.getElementById(
            "summary-total"
          ).textContent = `RM ${estimatedCost}`;
        }

        // Appointment details
        const appointmentDates =
          document.getElementById("appointment-dates").value;
        const appointmentTime =
          document.getElementById("appointment-time").value;
        const appointmentType =
          document.getElementById("appointment-type").value;

        document.getElementById("summary-appointment-dates").textContent =
          appointmentDates || "-";
        document.getElementById("summary-appointment-type").textContent =
          formatText(appointmentType);
        document.getElementById("summary-appointment-time").textContent =
          appointmentTime || "-";

        // Doctor/Specialist
        document.getElementById("summary-doctor").textContent =
          document.getElementById("doctor-name").value || "Not specified";

        // Medical facility
        document.getElementById("summary-facility").textContent =
          document.getElementById("facility-address").value || "-";

        // Transportation
        const transportation = document.querySelector(
          'input[name="transportation_mode"]:checked'
        );
        if (transportation) {
          const transportLabel =
            transportation.nextElementSibling.nextElementSibling.querySelector(
              "strong"
            ).textContent;
          document.getElementById("summary-transportation").textContent =
            transportLabel;
        }

        // Contact information
        document.getElementById("summary-name").textContent =
          document.getElementById("full-name").value || "-";
        document.getElementById("summary-ic-number").textContent =
          document.getElementById("ic-number").value || "-";
        document.getElementById("summary-phone").textContent =
          document.getElementById("phone").value || "-";
        document.getElementById("summary-email").textContent =
          document.getElementById("email").value || "-";
        document.getElementById("summary-relationship").textContent =
          formatText(document.getElementById("relationship").value) ||
          "Not specified";
        document.getElementById("summary-emergency").textContent =
          document.getElementById("emergency-contact").value || "-";
        document.getElementById("summary-employer").textContent =
          document.getElementById("employer").value || "Not specified";
        document.getElementById("summary-staff-id").textContent =
          document.getElementById("staff_id").value || "Not specified";

        // Care recipient information
        document.getElementById("summary-patient-name").textContent =
          document.getElementById("patient-name").value ||
          "Same as contact person";
        document.getElementById("summary-patient-age").textContent =
          document.getElementById("patient-age").value
            ? document.getElementById("patient-age").value + " years"
            : "Not specified";
        document.getElementById("summary-patient-gender").textContent =
          formatText(document.getElementById("patient-gender").value) ||
          "Not specified";
        document.getElementById("summary-patient-language").textContent =
          formatText(document.getElementById("patient-language").value) ||
          "English";
        document.getElementById("summary-patient-weight").textContent =
          document.getElementById("patient-weight").value
            ? document.getElementById("patient-weight").value + " kg"
            : "Not specified";
        document.getElementById("summary-patient-height").textContent =
          document.getElementById("patient-height").value
            ? document.getElementById("patient-height").value + " cm"
            : "Not specified";

        // Location details
        document.getElementById("summary-pickup").textContent =
          document.getElementById("pickup-address").value || "-";
        document.getElementById("summary-pickup-time").textContent =
          document.getElementById("pickup-time").value || "-";
        document.getElementById("summary-return").textContent =
          document.getElementById("return-address").value || "Same as pickup";
        document.getElementById("summary-transportation-notes").textContent =
          document.getElementById("transportation-notes").value ||
          "None specified";

        // Medical information
        document.getElementById("summary-medical-conditions").textContent =
          document.getElementById("medical-conditions").value ||
          "None specified";
        document.getElementById("summary-medications").textContent =
          document.getElementById("medications").value || "None specified";
        document.getElementById("summary-mobility").textContent =
          formatText(document.getElementById("mobility-assistance").value) ||
          "None";
        document.getElementById("summary-special-requirements").textContent =
          document.getElementById("special-requirements").value ||
          "None specified";

        // Companion preferences
        document.getElementById("summary-companion-gender").textContent =
          formatText(document.getElementById("companion-gender").value) ||
          "No preference";
        document.getElementById("summary-companion-language").textContent =
          formatText(document.getElementById("companion-language").value) ||
          "English";
        document.getElementById("summary-additional-notes").textContent =
          document.getElementById("additional-notes").value || "None";
        document.getElementById("summary-how-heard").textContent =
          formatText(document.getElementById("how-heard").value) ||
          "Google Search";
      }

      // Handle package selection
      document.addEventListener("DOMContentLoaded", function () {
        // Show/hide hours selection for hourly package
        document.addEventListener("change", function (e) {
          if (e.target.name === "package") {
            const hoursSelections =
              document.querySelectorAll(".hours-selection");
            hoursSelections.forEach((selection) => {
              selection.style.display = "none";
            });

            if (e.target.value === "hourly") {
              document.querySelector(
                "#hourly-package + .package-card .hours-selection"
              ).style.display = "block";
              // Make hours required when hourly is selected
              document
                .getElementById("hours")
                .setAttribute("required", "required");
            } else {
              // Remove required attribute when other packages are selected
              document.getElementById("hours").removeAttribute("required");
            }

            calculateMaxAppointments();
          }

          if (e.target.name === "package" || e.target.id === "hours") {
            calculateMaxAppointments();
          }
        });

        // Initialize components
        initializeAppointmentFlatpickr();
        calculateMaxAppointments();
        updateProgressSteps();
      });

      // Handle payment button click
      document
        .getElementById("pay-deposit-btn")
        .addEventListener("click", function (e) {
          e.preventDefault(); // Prevent default link behavior

          if (!validateCurrentStep()) {
            return false;
          }

          // Show loading state
          const payButton = this;
          const originalHTML = payButton.innerHTML;
          payButton.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> Processing...';
          payButton.style.pointerEvents = "none";

          // Generate booking reference
          const refNumber = "TM" + Date.now().toString().slice(-6);

          // Calculate estimated cost
          let estimatedCost = 0;
          const selectedPackage = document.querySelector(
            'input[name="package"]:checked'
          );
          if (selectedPackage) {
            if (selectedPackage.value === "hourly") {
              const hours = document.getElementById("hours").value;
              estimatedCost = hours * 35;
            } else if (selectedPackage.value === "package1") {
              estimatedCost = 132;
            } else if (selectedPackage.value === "package2") {
              estimatedCost = 186;
            }
          }

          // Prepare form data for Google Sheets
          const formData = new FormData();
          formData.append("booking_reference", refNumber);
          formData.append("service_type", "Health Appointment Support");
          formData.append("estimated_cost", `RM ${estimatedCost}`);

          // Get all form fields
          const form = document.getElementById("health-booking-form");
          const formElements = form.elements;

          for (let element of formElements) {
            if (element.name && element.value) {
              if (element.type === "checkbox" || element.type === "radio") {
                if (element.checked) {
                  formData.append(element.name, element.value);
                }
              } else {
                formData.append(element.name, element.value);
              }
            }
          }

          // Convert FormData to URLSearchParams for Google Apps Script
          const params = new URLSearchParams();
          for (let [key, value] of formData.entries()) {
            params.append(key, value);
          }

          // Submit to Google Apps Script
          const GOOGLE_SCRIPT_URL =
            "https://script.google.com/macros/s/AKfycbyCgUTeADPGkAdUOI7Je2-ZGnrbqtuRJwQC27aoJ0-ZfxVMUveenhuJHRNr7jLUScXF8g/exec";

          fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            body: params,
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.status === "success") {
                // Success - also submit to Formspree for email notification
                return fetch("https://formspree.io/f/xnnzgblw", {
                  method: "POST",
                  body: formData,
                  headers: {
                    Accept: "application/json",
                  },
                });
              } else {
                throw new Error(
                  "Google Sheets submission failed: " + data.message
                );
              }
            })
            .then((response) => {
              if (response.ok) {
                // Both submissions successful
                document.getElementById("booking-ref-number").textContent =
                  refNumber;
                document.getElementById("booking-success-modal").style.display =
                  "flex";

                // Redirect to payment page after short delay
                setTimeout(() => {
                  window.open(
                    "https://www.billplz.com/deposit4Teman",
                    "_blank"
                  );
                }, 2000);
              } else {
                throw new Error("Formspree submission failed");
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              alert(
                "There was an error submitting your booking. Please try again or contact us directly."
              );
            })
            .finally(() => {
              // Reset button state
              payButton.innerHTML = originalHTML;
              payButton.style.pointerEvents = "auto";
            });
        });

      // Close modal function
      function closeModal() {
        document.getElementById("booking-success-modal").style.display = "none";
      }

      // Load header and footer components
      async function loadComponents() {
        try {
          const headerResponse = await fetch("../components/header.html");
          if (headerResponse.ok) {
            const headerHTML = await headerResponse.text();
            document.getElementById("header-placeholder").innerHTML =
              headerHTML;

            setTimeout(() => {
              const bookingLink = document.querySelector(
                'a[href="booking.html"]'
              );
              if (bookingLink) {
                bookingLink.classList.add("active");
              }
              initializeNavigation();
            }, 100);
          }

          const footerResponse = await fetch("../components/footer.html");
          if (footerResponse.ok) {
            const footerHTML = await footerResponse.text();
            document.getElementById("footer-placeholder").innerHTML =
              footerHTML;
          }

          initializeMainJS();
        } catch (error) {
          console.error("Error loading components:", error);
        }
      }

      // Initialize navigation functionality
      function initializeNavigation() {
        const navToggle = document.getElementById("nav-toggle");
        const navMenu = document.getElementById("nav-menu");

        if (navToggle && navMenu) {
          navToggle.addEventListener("click", () => {
            navMenu.classList.toggle("show");
            const icon = navToggle.querySelector("i");
            if (navMenu.classList.contains("show")) {
              icon.className = "fas fa-times";
            } else {
              icon.className = "fas fa-bars";
            }
          });

          document.querySelectorAll(".nav__link").forEach((link) => {
            link.addEventListener("click", () => {
              navMenu.classList.remove("show");
              const icon = navToggle.querySelector("i");
              if (icon) icon.className = "fas fa-bars";
            });
          });

          document.addEventListener("click", (e) => {
            if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
              navMenu.classList.remove("show");
              const icon = navToggle.querySelector("i");
              if (icon) icon.className = "fas fa-bars";
            }
          });
        }

        window.addEventListener("scroll", () => {
          const header = document.getElementById("header");
          if (header) {
            if (window.scrollY > 100) {
              header.style.background = "rgba(255, 255, 255, 0.98)";
              header.style.boxShadow = "0 2px 20px rgba(0, 0, 0, 0.1)";
            } else {
              header.style.background = "rgba(255, 255, 255, 0.95)";
              header.style.boxShadow = "none";
            }
          }
        });
      }

      function initializeMainJS() {
        console.log(
          "Teman Malaysia health appointments booking loaded successfully!"
        );
      }

      // Make functions globally available
      window.calculateMaxAppointments = calculateMaxAppointments;
      window.nextStep = nextStep;
      window.prevStep = prevStep;
      window.closeModal = closeModal;

      document.addEventListener("DOMContentLoaded", function () {
        loadComponents();
      });
    </script>
    <script src="../assets/js/main.js"></script>
  </body>
</html>
