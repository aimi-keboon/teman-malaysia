<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book Dialysis Support - Teman Malaysia</title>
    <meta
      name="description"
      content="Dedicated transport service for dialysis sessions with proactive companions."
    />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../assets/images/favicon.png" />
    <link rel="apple-touch-icon" href="../assets/images/apple-touch-icon.png" />

    <!-- CSS -->
    <link rel="stylesheet" href="../assets/css/main.css" />
    <link rel="stylesheet" href="../assets/css/responsive.css" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Include Flatpickr CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />

    <style>
      /* Reset and base styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
        color: #374151;
        background: #f9fafb;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* Header Styles */
      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
        transition: all 0.3s ease;
      }

      .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 0;
      }

      .nav__logo {
        height: 40px;
        width: auto;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 500;
        text-decoration: none;
        border: none;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 14px;
      }

      .btn--primary {
        background: #ef4444;
        color: white;
      }

      .btn--primary:hover {
        background: #dc2626;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      }

      .btn--outline {
        background: transparent;
        color: #ef4444;
        border: 2px solid #ef4444;
      }

      .btn--outline:hover {
        background: #ef4444;
        color: white;
        transform: translateY(-2px);
      }

      .btn--large {
        padding: 16px 32px;
        font-size: 16px;
      }

      .btn--success {
        background: #10b981;
        color: white;
      }

      .btn--success:hover {
        background: #059669;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
      }

      /* Main Section */
      .booking-section {
        padding: 120px 0 80px 0;
        min-height: 100vh;
      }

      .booking__header {
        text-align: center;
        margin-bottom: 60px;
      }

      .booking__title {
        font-size: 3rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 16px;
      }

      .booking__subtitle {
        font-size: 1.25rem;
        color: #6b7280;
        max-width: 600px;
        margin: 0 auto;
      }

      .service-info-card {
        background: white;
        border-radius: 16px;
        padding: 32px;
        margin: 0 auto 40px auto;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 2px solid #e5f3ff;
        max-width: 800px;
      }

      .service-header {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 24px;
      }

      .service-icon {
        width: 60px;
        height: 60px;
        background: #ef4444;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      .service-icon i {
        font-size: 24px;
        color: white;
      }

      .service-header h2 {
        font-size: 1.75rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
      }

      .service-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 16px;
        margin-top: 24px;
      }

      .feature-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #4b5563;
      }

      .feature-item i {
        color: #10b981;
        font-size: 12px;
      }

      /* Progress Steps */
      .progress-steps {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 40px 0 60px 0;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        gap: 80px;
      }

      .step {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .step__number {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 18px;
        background: #e5e7eb;
        color: #6b7280;
        border: 3px solid #e5e7eb;
        transition: all 0.3s ease;
        margin-bottom: 12px;
      }

      .step.active .step__number {
        background: #ef4444;
        color: white;
        border-color: #ef4444;
        box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
      }

      .step.completed .step__number {
        background: #10b981;
        color: white;
        border-color: #10b981;
      }

      .step__label {
        font-size: 14px;
        font-weight: 500;
        color: #6b7280;
        text-align: center;
        transition: color 0.3s ease;
        white-space: nowrap;
      }

      .step.active .step__label {
        color: #ef4444;
        font-weight: 600;
      }

      .step.completed .step__label {
        color: #10b981;
        font-weight: 600;
      }

      /* Form Container */
      .booking__container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        overflow: hidden;
      }

      /* Form Styles */
      .booking-form {
        padding: 40px;
      }

      .form-step {
        display: none;
      }

      .form-step.active {
        display: block;
      }

      .step-title {
        font-size: 2rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 32px;
        text-align: center;
      }

      /* Package Selection */
      .package-options {
        display: grid;
        gap: 20px;
        margin-bottom: 40px;
      }

      .package-option {
        position: relative;
      }

      .package-option input[type="radio"] {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .package-card {
        display: block;
        padding: 24px;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
      }

      .package-card:hover {
        border-color: #ef4444;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.1);
      }

      .package-option input[type="radio"]:checked + .package-card {
        border-color: #ef4444;
        background: #fef2f2;
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.1);
      }

      .package-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .package-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
      }

      .package-price {
        font-size: 1.5rem;
        font-weight: 700;
        color: #ef4444;
      }

      .package-description {
        color: #6b7280;
        margin-bottom: 16px;
      }

      .hours-selection {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
      }

      .package-notes {
        margin-top: 16px;
        padding: 12px;
        background: #f9fafb;
        border-radius: 6px;
      }

      .package-notes small {
        display: block;
        color: #6b7280;
        margin-bottom: 4px;
      }

      /* Form Sections */
      .form-section {
        margin-bottom: 40px;
        padding: 24px;
        background: #f9fafb;
        border-radius: 12px;
      }

      .form-section-title {
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 24px;
      }

      .form-section-title i {
        color: #ef4444;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
        margin-top: 10px;
      }

      .form-label {
        font-weight: 500;
        color: #374151;
        margin-bottom: 8px;
        font-size: 14px;
      }

      .form-input,
      .form-select,
      .form-textarea {
        padding: 12px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-input:focus,
      .form-select:focus,
      .form-textarea:focus {
        outline: none;
        border-color: #ef4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
      }

      .form-help {
        font-size: 12px;
        color: #6b7280;
        margin-top: 4px;
      }

      /* Radio and Checkbox Options */
      .radio-option,
      .checkbox-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        padding: 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 12px;
      }

      .radio-option:hover,
      .checkbox-item:hover {
        border-color: #ef4444;
      }

      .radio-option input[type="radio"],
      .checkbox-item input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .radio-custom,
      .checkmark {
        width: 20px;
        height: 20px;
        border: 2px solid #d1d5db;
        position: relative;
        flex-shrink: 0;
        transition: all 0.3s ease;
      }

      .radio-custom {
        border-radius: 50%;
      }

      .checkmark {
        border-radius: 4px;
      }

      .radio-option:hover .radio-custom,
      .checkbox-item:hover .checkmark {
        border-color: #ef4444;
      }

      .radio-option input[type="radio"]:checked ~ .radio-custom {
        border-color: #ef4444;
      }

      .radio-option input[type="radio"]:checked ~ .radio-custom::after {
        content: "";
        width: 8px;
        height: 8px;
        background: #ef4444;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .checkbox-item input[type="checkbox"]:checked ~ .checkmark {
        background: #ef4444;
        border-color: #ef4444;
      }

      .checkbox-item input[type="checkbox"]:checked ~ .checkmark::after {
        content: "✓";
        color: white;
        font-size: 12px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .radio-content strong {
        display: block;
        margin-bottom: 4px;
        color: #1f2937;
      }

      .radio-content p {
        font-size: 14px;
        color: #6b7280;
        margin: 0;
      }

      /* Fixed checkbox styling */
      .terms-checkbox {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        cursor: pointer;
        margin-bottom: 32px;
      }

      .terms-checkbox input[type="checkbox"] {
        opacity: 0;
        position: absolute;
        pointer-events: none;
      }

      .terms-checkbox .checkmark {
        width: 20px;
        height: 20px;
        border: 2px solid #d1d5db;
        border-radius: 4px;
        position: relative;
        flex-shrink: 0;
        transition: all 0.3s ease;
        margin-top: 2px;
      }

      .terms-checkbox:hover .checkmark {
        border-color: #ef4444;
      }

      .terms-checkbox input[type="checkbox"]:checked ~ .checkmark {
        background: #ef4444;
        border-color: #ef4444;
      }

      .terms-checkbox input[type="checkbox"]:checked ~ .checkmark::after {
        content: "✓";
        color: white;
        font-size: 12px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .terms-text {
        font-size: 14px;
        color: #374151;
      }

      .terms-text a {
        color: #ef4444;
        text-decoration: none;
      }

      .terms-text a:hover {
        text-decoration: underline;
      }

      /* Summary Styles */
      .booking-summary {
        display: grid;
        gap: 24px;
        margin-bottom: 32px;
      }

      .summary-card {
        background: #f9fafb;
        border-radius: 12px;
        padding: 24px;
        border: 1px solid #e5e7eb;
      }

      .summary-card h3 {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #1f2937;
        margin-bottom: 20px;
        font-size: 1.25rem;
        font-weight: 600;
      }

      .summary-card h3 i {
        color: #ef4444;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e5e7eb;
      }

      .summary-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }

      .summary-label {
        font-weight: 500;
        color: #6b7280;
        flex: 0 0 40%;
      }

      .summary-value {
        color: #1f2937;
        text-align: right;
        flex: 1;
        word-break: break-word;
      }

      .summary-item.total {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 2px solid #ef4444;
        font-size: 1.125rem;
        font-weight: 600;
      }

      .summary-item.total .summary-label {
        color: #1f2937;
      }

      .summary-item.total .summary-value {
        color: #ef4444;
        font-size: 1.25rem;
      }

      .cost-note {
        font-size: 12px;
        color: #6b7280;
        margin-top: 8px;
        font-style: italic;
      }

      /* Form Actions */
      .form-actions {
        display: flex;
        justify-content: space-between;
        gap: 16px;
        margin-top: 40px;
      }

      /* Back Link */
      .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: #6b7280;
        text-decoration: none;
        margin-bottom: 24px;
        font-size: 14px;
        transition: color 0.3s ease;
      }

      .back-link:hover {
        color: #ef4444;
      }

      /* Error styling */
      .error {
        border-color: #ef4444 !important;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
      }

      .error-message {
        color: #ef4444;
        font-size: 12px;
        margin-top: 4px;
      }

      /* Modal */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal-content {
        background: white;
        border-radius: 16px;
        padding: 40px;
        max-width: 500px;
        text-align: center;
        margin: 20px;
      }

      .success-icon {
        font-size: 4rem;
        color: #10b981;
        margin-bottom: 20px;
      }

      .modal-content h2 {
        color: #1f2937;
        margin-bottom: 16px;
      }

      .booking-reference {
        background: #f3f4f6;
        padding: 16px;
        border-radius: 8px;
        margin: 20px 0;
      }

      .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 24px;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .booking__title {
          font-size: 2rem;
        }

        .booking-form {
          padding: 24px;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .form-actions {
          flex-direction: column;
        }

        .service-header {
          flex-direction: column;
          text-align: center;
          align-items: center;
        }

        .service-icon {
          margin-bottom: 16px;
        }

        .progress-steps {
          margin: 30px 0 40px 0;
          gap: 40px;
        }

        .step__number {
          width: 40px;
          height: 40px;
          font-size: 16px;
        }

        .step__label {
          font-size: 12px;
        }

        .package-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }
      }

      .text-center {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <!-- Header Component -->
    <div id="header-placeholder"></div>

    <!-- Booking Section -->
    <section class="booking-section">
      <div class="container">
        <a href="booking.html" class="back-link">
          <i class="fas fa-arrow-left"></i>
          Back to Services
        </a>

        <div class="booking__header text-center">
          <h1 class="booking__title">Dialysis Treatment Support</h1>
          <p class="booking__subtitle">
            Dedicated transport service for dialysis sessions with proactive
            companions.
          </p>
        </div>

        <!-- Service Information Card -->
        <div class="service-info-card">
          <div class="service-header">
            <div class="service-icon">
              <i class="fas fa-heartbeat"></i>
            </div>
            <h2>TEMAN to Dialysis Treatments</h2>
          </div>
          <p>
            Plan your dialysis sessions with the convenience of return transport
            to the center. If needed, request an assistive companion who
            understands the unique dialysis needs for support during treatment.
          </p>

          <div class="service-features">
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Pick-up & drop-off transport between home & dialysis center
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Physical & mobility assistance
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Pre- and post-treatment care
            </div>
            <div class="feature-item">
              <i class="fas fa-check"></i>
              Companionship and support during session (optional)
            </div>
          </div>
        </div>

        <div class="booking__container">
          <!-- Progress Steps -->
          <div class="progress-steps" id="progressSteps">
            <div class="step active" data-step="1">
              <div class="step__number">1</div>
              <div class="step__label">Package</div>
            </div>
            <div class="step" data-step="2">
              <div class="step__number">2</div>
              <div class="step__label">Details</div>
            </div>
            <div class="step" data-step="3">
              <div class="step__number">3</div>
              <div class="step__label">Confirm</div>
            </div>
          </div>

          <!-- Booking Form -->
          <form
            id="dialysis-booking-form"
            class="booking-form"
            data-form-type="dialysis"
            action="https://formspree.io/f/xzzvjavz"
            method="POST"
          >
            <!-- Step 1: Package Selection -->
            <div class="form-step active" data-step="1">
              <h2 class="step-title">Choose Your Package</h2>

              <div class="package-options">
                <div class="package-option">
                  <input
                    type="radio"
                    name="package"
                    value="hourly"
                    id="hourly-package"
                    required
                  />
                  <label for="hourly-package" class="package-card">
                    <div class="package-header">
                      <div class="package-title">
                        Single session: Transport Service Hourly Rate
                      </div>
                      <div class="package-price">RM35/hour</div>
                    </div>
                    <div class="package-description">
                      Choose number of hours required for drop-off and pickup.
                      Please allow travel time and pre- and post- treatment
                      waiting time. Service does not include companionship
                    </div>

                    <div class="hours-selection" style="display: none">
                      <label for="hours" class="form-label"
                        >Number of Hours: *</label
                      >
                      <select name="hours" id="hours" class="form-select">
                        <option value="">Select hours</option>
                        <option value="2">
                          2 hours - RM70 (Minimum for 1 session)
                        </option>
                        <option value="3">3 hours - RM105</option>
                        <option value="4">4 hours - RM140</option>
                        <option value="5">5 hours - RM175</option>
                        <option value="6">6 hours - RM210</option>
                        <option value="" disabled>
                          More than 6 hours (Contact us)
                        </option>
                      </select>
                    </div>
                  </label>
                </div>

                <div class="package-option">
                  <input
                    type="radio"
                    name="package"
                    value="package1"
                    id="package1"
                  />
                  <label for="package1" class="package-card">
                    <div class="package-header">
                      <div class="package-title">
                        Multi-session Package: 3 x 2 hour Sessions
                      </div>
                      <div class="package-price">
                        RM186 <small>(RM31.00/hour)</small>
                      </div>
                    </div>
                    <div class="package-description">
                      3 dialysis sessions at 2 hours service each. Service
                      Inclusive of transportation, travel time and pre-post
                      treatments waiting time. Service does not include
                      companionship DURING treatment.
                    </div>
                  </label>
                </div>
              </div>

              <div
                style="
                  background: #f3e5f5;
                  border: 2px dashed #9c27b0;
                  border-radius: 12px;
                  padding: 20px;
                  margin: 30px 0;
                "
              >
                <h4
                  style="
                    color: #7b1fa2;
                    margin-bottom: 12px;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                  "
                >
                  <i class="fas fa-plus-circle"></i>
                  Add-On Companion Service (Optional)
                </h4>

                <div class="package-option" style="margin: 0">
                  <input
                    type="checkbox"
                    name="companion_addon"
                    value="companion"
                    id="companion-addon"
                  />
                  <label
                    for="companion-addon"
                    class="package-card"
                    style="border-color: #9c27b0"
                  >
                    <div class="package-header">
                      <div class="package-title">
                        Comprehensive Companion Service (Hourly Rate)
                      </div>
                      <div class="package-price">+RM30/hour</div>
                    </div>
                    <div class="package-description">
                      Dialysis sessions do take awhile. Request the Temanion to
                      stay with you through it, so you are not alone. Price and
                      hours are added-on to basic transport service rate. They
                      may assist you with:
                    </div>

                    <div class="hours-selection" style="display: none">
                      <label for="companion-hours" class="form-label"
                        >Treatment Duration: *</label
                      >
                      <select
                        name="companion_hours"
                        id="companion-hours"
                        class="form-select"
                      >
                        <option value="">Select treatment duration</option>
                        <option value="2">2 hours - +RM60</option>
                        <option value="3">3 hours - +RM90</option>
                        <option value="4">4 hours - +RM120</option>
                        <option value="5">5 hours - +RM150</option>
                        <option value="6">6 hours - +RM180</option>
                      </select>
                    </div>

                    <div class="package-notes">
                      <small>• Physical & Emotional support</small>
                      <small>• Social companionship & activities</small>
                      <small>• Administrative support</small>
                      <small>• Communication between family & providers</small>
                    </div>
                  </label>
                </div>
              </div>

              <div
                style="
                  background: #fef2f2;
                  padding: 16px;
                  border-radius: 8px;
                  margin-bottom: 32px;
                "
              >
                <h4 style="color: #dc2626; margin-bottom: 8px">
                  Additional Information:
                </h4>
                <small
                  style="display: block; color: #dc2626; margin-bottom: 4px"
                  >• Transportation fee: RM0.80/KM or e-hailing fare</small
                >
                <small style="display: block; color: #dc2626"
                  >• Surcharge: RM37/hour for Public Holiday/Sunday/last minute
                  booking</small
                >
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn--primary btn--large"
                  onclick="nextStep()"
                >
                  Continue to Details
                  <i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>

            <!-- Step 2: Personal Details -->
            <div class="form-step" data-step="2">
              <h2 class="step-title">Booking Details</h2>

              <!-- Contact Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-user"></i>
                  Contact Information
                </h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="full-name" class="form-label"
                      >Full Name *</label
                    >
                    <input
                      type="text"
                      id="full-name"
                      name="full_name"
                      class="form-input"
                      placeholder="Enter your full name"
                      required
                    />
                  </div>

                  <div class="form-group">
                    <label for="relationship" class="form-label"
                      >Relationship to Care Recipient</label
                    >
                    <select
                      id="relationship"
                      name="relationship"
                      class="form-select"
                    >
                      <option value="">Select relationship</option>
                      <option value="self">Self</option>
                      <option value="spouse">Spouse</option>
                      <option value="child">Son/Daughter</option>
                      <option value="parent">Parent</option>
                      <option value="sibling">Brother/Sister</option>
                      <option value="relative">Other Relative</option>
                      <option value="caregiver">Professional Caregiver</option>
                      <option value="friend">Friend</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="phone" class="form-label">Phone Number *</label>
                    <input
                      type="tel"
                      id="phone"
                      name="phone"
                      class="form-input"
                      placeholder="+60 11-234 5678"
                      required
                    />
                  </div>

                  <div class="form-group">
                    <label for="email" class="form-label"
                      >Email Address *</label
                    >
                    <input
                      type="email"
                      id="email"
                      name="email"
                      class="form-input"
                      placeholder="your.email@example.com"
                      required
                    />
                    <small class="form-help"
                      >Use company email if claiming staff benefit</small
                    >
                  </div>

                  <div class="form-group">
                    <label for="employer" class="form-label"
                      >Employer Name</label
                    >
                    <input
                      type="text"
                      id="employer"
                      name="employer"
                      class="form-input"
                    />
                    <small class="form-help"
                      >For those claiming for Staff Benefit only</small
                    >
                  </div>

                  <div class="form-group">
                    <label for="staff_id" class="form-label">Staff ID</label>
                    <input
                      type="text"
                      id="staff_id"
                      name="staff_id"
                      class="form-input"
                    />
                    <small class="form-help"
                      >For those claiming for Staff Benefit only</small
                    >
                  </div>
                </div>

                <div class="form-group">
                  <label for="emergency-contact" class="form-label"
                    >Emergency Contact Person *</label
                  >
                  <input
                    type="text"
                    id="emergency-contact"
                    name="emergency_contact"
                    class="form-input"
                    placeholder="Name and phone number of emergency contact"
                    required
                  />
                </div>
              </div>

              <!-- Care Recipient Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-heart-pulse"></i>
                  Care Recipient Information
                </h3>
                <div class="form-grid">
                  <div class="form-group">
                    <label for="patient-name" class="form-label"
                      >Care Recipient Name</label
                    >
                    <input
                      type="text"
                      id="patient-name"
                      name="patient_name"
                      class="form-input"
                      placeholder="If different from contact person"
                    />
                  </div>

                  <div class="form-group">
                    <label for="patient-age" class="form-label"
                      >Care Recipient Age</label
                    >
                    <input
                      type="number"
                      id="patient-age"
                      name="patient_age"
                      class="form-input"
                      min="1"
                      max="120"
                      placeholder="Age in years"
                    />
                  </div>

                  <div class="form-group">
                    <label for="patient-gender" class="form-label"
                      >Gender</label
                    >
                    <select
                      id="patient-gender"
                      name="patient_gender"
                      class="form-select"
                    >
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="patient-language" class="form-label"
                      >Preferred Language</label
                    >
                    <select
                      id="patient-language"
                      name="patient_language"
                      class="form-select"
                    >
                      <option value="english">English</option>
                      <option value="bahasa">Bahasa Malaysia</option>
                      <option value="other">Other</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="patient-weight" class="form-label"
                      >Care Recipient Weight</label
                    >
                    <input
                      type="number"
                      id="patient-weight"
                      name="patient_weight"
                      class="form-input"
                      placeholder="Weight in kg"
                    />
                  </div>

                  <div class="form-group">
                    <label for="patient-height" class="form-label"
                      >Care Recipient Height</label
                    >
                    <input
                      type="number"
                      id="patient-height"
                      name="patient_height"
                      class="form-input"
                      placeholder="Height in cm"
                    />
                  </div>
                </div>
              </div>

              <!-- Care Schedule -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-calendar-alt"></i>
                  Dialysis Treatment Schedule
                </h3>

                <!-- Multi-date calendar -->
                <div class="form-group">
                  <label for="multi-dates" class="form-label"
                    >Select Dialysis Treatment Dates *</label
                  >
                  <input
                    type="text"
                    id="multi-dates"
                    name="multi_dates"
                    class="form-input"
                    placeholder="Select treatment dates"
                    readonly
                    required
                  />
                  <small class="form-help"
                    >Select specific dates; today and tomorrow are
                    disabled</small
                  >
                  <div
                    id="date-limit-message"
                    style="
                      display: none;
                      color: #666;
                      margin-top: 5px;
                      font-size: 0.875rem;
                    "
                  >
                    If you're unsure of the remaining dates, you may plan or
                    book them later with our representative.
                  </div>
                  <div
                    id="date-count"
                    style="color: #666; margin-top: 5px; font-size: 0.875rem"
                  >
                    Selected dates: <span id="selected-count">0</span>/<span
                      id="max-dates"
                      >0</span
                    >
                    sessions
                  </div>
                  <div
                    id="hours-info"
                    style="
                      color: #ef4444;
                      margin-top: 5px;
                      font-size: 0.875rem;
                      font-weight: 500;
                    "
                  >
                    Please select a package first to enable date selection
                  </div>
                </div>

                <!-- Time Selection -->
                <div class="form-grid">
                  <div class="form-group">
                    <label for="preferred-start-time" class="form-label"
                      >Treatment Start Time *</label
                    >
                    <input
                      type="time"
                      id="preferred-start-time"
                      name="preferred_start_time"
                      class="form-input"
                      required
                    />
                    <small class="form-help"
                      >Recommended: 30-45 minutes before dialysis
                      appointment</small
                    >
                  </div>

                  <div class="form-group">
                    <label for="session-duration" class="form-label"
                      >Typical Session Duration</label
                    >
                    <select
                      id="session-duration"
                      name="session_duration"
                      class="form-select"
                    >
                      <option value="">Select duration</option>
                      <option value="2">2 hours (minimum)</option>
                      <option value="3">3 hours</option>
                      <option value="4">4 hours</option>
                      <option value="5">5 hours</option>
                      <option value="6">6+ hours</option>
                    </select>
                    <small class="form-help"
                      >This helps us plan the service duration</small
                    >
                  </div>
                </div>
              </div>

              <!-- Location Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-map-marker-alt"></i>
                  Location Details
                </h3>
                <div class="form-group">
                  <label for="center-address" class="form-label"
                    >Dialysis Center Address *</label
                  >
                  <textarea
                    id="center-address"
                    name="center_address"
                    class="form-textarea"
                    rows="3"
                    placeholder="Complete address of the dialysis center"
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="pickup-address" class="form-label"
                    >Pickup Address *</label
                  >
                  <textarea
                    id="pickup-address"
                    name="pickup_address"
                    class="form-textarea"
                    rows="3"
                    placeholder="Address where our Temanion should meet you"
                    required
                  ></textarea>
                </div>

                <div class="form-grid">
                  <div class="form-group">
                    <label for="pickup-time" class="form-label"
                      >Preferred Pickup Time</label
                    >
                    <input
                      type="time"
                      id="pickup-time"
                      name="pickup_time"
                      class="form-input"
                    />
                    <small class="form-help"
                      >We recommend 30-45 minutes before treatment time</small
                    >
                  </div>

                  <div class="form-group">
                    <label for="return-address" class="form-label"
                      >Return Address</label
                    >
                    <input
                      type="text"
                      id="return-address"
                      name="return_address"
                      class="form-input"
                      placeholder="If different from pickup address"
                    />
                  </div>
                </div>
              </div>

              <!-- Transportation -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-car"></i>
                  Transportation for Activities
                </h3>
                <div style="display: grid; gap: 12px">
                  <label class="radio-option">
                    <input
                      type="radio"
                      name="transportation_mode"
                      value="client-provided"
                      required
                    />
                    <span class="radio-custom"></span>
                    <div class="radio-content">
                      <strong>I will provide transportation</strong>
                    </div>
                  </label>

                  <label class="radio-option">
                    <input
                      type="radio"
                      name="transportation_mode"
                      value="teman-provided"
                      required
                    />
                    <span class="radio-custom"></span>
                    <div class="radio-content">
                      <strong>Temanion will arrange transportation</strong>
                    </div>
                  </label>

                  <label class="radio-option">
                    <input
                      type="radio"
                      name="transportation_mode"
                      value="e-hailing"
                      required
                    />
                    <span class="radio-custom"></span>
                    <div class="radio-content">
                      <strong>E-Hailing Service (Grab/Taxi)</strong>
                    </div>
                  </label>
                </div>

                <div class="form-group" style="margin-top: 16px">
                  <label for="transportation-notes" class="form-label"
                    >Transportation Notes</label
                  >
                  <textarea
                    id="transportation-notes"
                    name="transportation_notes"
                    class="form-textarea"
                    rows="2"
                    placeholder="Any specific transportation preferences, accessibility needs, or special instructions..."
                  ></textarea>
                </div>
              </div>

              <!-- Medical Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-notes-medical"></i>
                  Medical & Care Information
                </h3>

                <div class="form-group">
                  <label for="medical-conditions" class="form-label"
                    >Related Medical Conditions *</label
                  >
                  <textarea
                    id="medical-conditions"
                    name="medical_conditions"
                    class="form-textarea"
                    rows="3"
                    placeholder="Please list diabetes, hypertension, heart conditions, or other health concerns related to dialysis..."
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="medications" class="form-label"
                    >Current Medications</label
                  >
                  <textarea
                    id="medications"
                    name="medications"
                    class="form-textarea"
                    rows="2"
                    placeholder="List current medications, especially those related to dialysis treatment..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="dietary-restrictions" class="form-label"
                    >Dietary Restrictions *</label
                  >
                  <textarea
                    id="dietary-restrictions"
                    name="dietary_restrictions"
                    class="form-textarea"
                    rows="2"
                    placeholder="Fluid restrictions, potassium limits, phosphorus restrictions, etc..."
                    required
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="mobility-assistance" class="form-label"
                    >Mobility Assistance Needed *</label
                  >
                  <select
                    id="mobility-assistance"
                    name="mobility_assistance"
                    class="form-select"
                    required
                  >
                    <option value="">Select mobility assistance</option>
                    <option value="none">None</option>
                    <option value="wheelchair">Wheelchair assistance</option>
                    <option value="walker">Walker/walking aid</option>
                    <option value="walking">Walking assistance</option>
                    <option value="other">Other</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="special-requirements" class="form-label"
                    >Special Requirements *</label
                  >
                  <textarea
                    id="special-requirements"
                    name="special_requirements"
                    class="form-textarea"
                    rows="3"
                    placeholder="Any specific dialysis-related needs, emergency procedures, allergies, or other important information..."
                    required
                  ></textarea>
                </div>
              </div>

              <!-- Companion Preferences -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-user-friends"></i>
                  Companion Preferences
                </h3>

                <div class="form-grid">
                  <div class="form-group">
                    <label for="companion-gender" class="form-label"
                      >Preferred Gender</label
                    >
                    <select
                      id="companion-gender"
                      name="companion_gender"
                      class="form-select"
                    >
                      <option value="no-preference">No preference</option>
                      <option value="female">Female</option>
                      <option value="male">Male</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label for="companion-language" class="form-label"
                      >Language Preference</label
                    >
                    <select
                      id="companion-language"
                      name="companion_language"
                      class="form-select"
                    >
                      <option value="english">English</option>
                      <option value="bahasa">Bahasa Malaysia</option>
                      <option value="other">Other</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Additional Information -->
              <div class="form-section">
                <h3 class="form-section-title">
                  <i class="fas fa-comment-dots"></i>
                  Additional Information
                </h3>

                <div class="form-group">
                  <label for="treatment-schedule" class="form-label"
                    >Regular Treatment Schedule</label
                  >
                  <textarea
                    id="treatment-schedule"
                    name="treatment_schedule"
                    class="form-textarea"
                    rows="3"
                    placeholder="Please describe your regular dialysis schedule (e.g., Monday, Wednesday, Friday at 8:00 AM)..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="additional-notes" class="form-label"
                    >Additional Notes</label
                  >
                  <textarea
                    id="additional-notes"
                    name="additional_notes"
                    class="form-textarea"
                    rows="4"
                    placeholder="Any other information, concerns, or special requests related to your dialysis treatment support..."
                  ></textarea>
                </div>

                <div class="form-group">
                  <label for="how-heard" class="form-label"
                    >How did you hear about us? *</label
                  >
                  <select
                    id="how-heard"
                    name="how_heard"
                    class="form-select"
                    required
                  >
                    <option value="">Please select an option</option>
                    <option value="google">Google Search</option>
                    <option value="facebook">Facebook</option>
                    <option value="instagram">Instagram</option>
                    <option value="friend">Friend/Family Referral</option>
                    <option value="doctor">Doctor/Medical Professional</option>
                    <option value="hospital">Hospital/Clinic</option>
                    <option value="newspaper">Newspaper/Magazine</option>
                    <option value="radio">Radio</option>
                    <option value="other">Other</option>
                  </select>
                </div>
              </div>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn--outline btn--large"
                  onclick="prevStep()"
                >
                  <i class="fas fa-arrow-left"></i>
                  Previous
                </button>
                <button
                  type="button"
                  class="btn btn--primary btn--large"
                  onclick="nextStep()"
                >
                  Review Booking
                  <i class="fas fa-arrow-right"></i>
                </button>
              </div>
            </div>

            <!-- Step 3: Confirmation -->
            <div class="form-step" data-step="3">
              <h2 class="step-title">Booking Summary</h2>

              <div class="booking-summary">
                <!-- Package & Service Details -->
                <div class="summary-card">
                  <h3><i class="fas fa-clipboard-list"></i> Service Details</h3>
                  <div class="summary-item">
                    <span class="summary-label">Service:</span>
                    <span class="summary-value"
                      >Dialysis Treatment Support</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Package:</span>
                    <span class="summary-value" id="summary-package">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Companion Add-on:</span>
                    <span class="summary-value" id="summary-companion">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Treatment Dates:</span>
                    <span class="summary-value" id="summary-dates">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Treatment Start Time:</span>
                    <span class="summary-value" id="summary-start-time">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Transportation:</span>
                    <span class="summary-value" id="summary-transportation"
                      >-</span
                    >
                  </div>
                  <div class="summary-divider"></div>
                  <div class="summary-item total">
                    <span class="summary-label">Estimated Cost:</span>
                    <span class="summary-value" id="summary-total">RM 0</span>
                  </div>
                  <p class="cost-note">
                    *Final cost may vary based on additional services,
                    transportation fees and allowance
                  </p>
                </div>

                <!-- Contact Information -->
                <div class="summary-card">
                  <h3><i class="fas fa-user"></i> Contact Information</h3>
                  <div class="summary-item">
                    <span class="summary-label">Name:</span>
                    <span class="summary-value" id="summary-name">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Phone:</span>
                    <span class="summary-value" id="summary-phone">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Email:</span>
                    <span class="summary-value" id="summary-email">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Emergency Contact:</span>
                    <span class="summary-value" id="summary-emergency">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Relationship:</span>
                    <span class="summary-value" id="summary-relationship"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Employer:</span>
                    <span class="summary-value" id="summary-employer">-</span>
                  </div>
                </div>

                <!-- Care Recipient Information -->
                <div class="summary-card">
                  <h3>
                    <i class="fas fa-heart-pulse"></i> Care Recipient
                    Information
                  </h3>
                  <div class="summary-item">
                    <span class="summary-label">Name:</span>
                    <span class="summary-value" id="summary-patient-name"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Age:</span>
                    <span class="summary-value" id="summary-patient-age"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Gender:</span>
                    <span class="summary-value" id="summary-patient-gender"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Preferred Language:</span>
                    <span class="summary-value" id="summary-patient-language"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Weight:</span>
                    <span class="summary-value" id="summary-patient-weight"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Height:</span>
                    <span class="summary-value" id="summary-patient-height"
                      >-</span
                    >
                  </div>
                </div>

                <!-- Location Details -->
                <div class="summary-card">
                  <h3>
                    <i class="fas fa-map-marker-alt"></i> Location Details
                  </h3>
                  <div class="summary-item">
                    <span class="summary-label">Dialysis Center:</span>
                    <span class="summary-value" id="summary-center-address"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Pickup Address:</span>
                    <span class="summary-value" id="summary-pickup-address"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Return Address:</span>
                    <span class="summary-value" id="summary-return-address"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Preferred Pickup Time:</span>
                    <span class="summary-value" id="summary-pickup-time"
                      >-</span
                    >
                  </div>
                </div>

                <!-- Medical & Care Information -->
                <div class="summary-card">
                  <h3>
                    <i class="fas fa-notes-medical"></i> Medical & Care
                    Information
                  </h3>
                  <div class="summary-item">
                    <span class="summary-label">Medical Conditions:</span>
                    <span class="summary-value" id="summary-medical-conditions"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Medications:</span>
                    <span class="summary-value" id="summary-medications"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Dietary Restrictions:</span>
                    <span class="summary-value" id="summary-dietary">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Mobility Assistance:</span>
                    <span class="summary-value" id="summary-mobility">-</span>
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Special Requirements:</span>
                    <span
                      class="summary-value"
                      id="summary-special-requirements"
                      >-</span
                    >
                  </div>
                </div>

                <!-- Companion Preferences -->
                <div class="summary-card">
                  <h3>
                    <i class="fas fa-user-friends"></i> Companion Preferences
                  </h3>
                  <div class="summary-item">
                    <span class="summary-label">Preferred Gender:</span>
                    <span class="summary-value" id="summary-companion-gender"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Language Preference:</span>
                    <span class="summary-value" id="summary-companion-language"
                      >-</span
                    >
                  </div>
                </div>

                <!-- Additional Information -->
                <div class="summary-card">
                  <h3>
                    <i class="fas fa-comment-dots"></i> Additional Information
                  </h3>
                  <div class="summary-item">
                    <span class="summary-label"
                      >Regular Treatment Schedule:</span
                    >
                    <span class="summary-value" id="summary-treatment-schedule"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label">Additional Notes:</span>
                    <span class="summary-value" id="summary-additional-notes"
                      >-</span
                    >
                  </div>
                  <div class="summary-item">
                    <span class="summary-label"
                      >How did you hear about us:</span
                    >
                    <span class="summary-value" id="summary-how-heard">-</span>
                  </div>
                </div>
              </div>

              <div
                style="
                  background: #fef2f2;
                  border: 1px solid #fecaca;
                  border-radius: 12px;
                  padding: 24px;
                  margin-bottom: 32px;
                "
              >
                <h3
                  style="
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    color: #dc2626;
                    margin-bottom: 16px;
                  "
                >
                  <i class="fas fa-info-circle"></i> What Happens Next?
                </h3>
                <ul style="list-style: none; padding: 0">
                  <li
                    style="
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      margin-bottom: 12px;
                      color: #dc2626;
                    "
                  >
                    <i
                      class="fas fa-credit-card"
                      style="width: 20px; text-align: center"
                    ></i>
                    Pay a small deposit to secure your booking
                  </li>
                  <li
                    style="
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      margin-bottom: 12px;
                      color: #dc2626;
                    "
                  >
                    <i
                      class="fas fa-phone"
                      style="width: 20px; text-align: center"
                    ></i>
                    Our team will contact you within 24 hours to confirm details
                  </li>
                  <li
                    style="
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      margin-bottom: 12px;
                      color: #dc2626;
                    "
                  >
                    <i
                      class="fas fa-user-check"
                      style="width: 20px; text-align: center"
                    ></i>
                    We will assign a Temanion familiar with dialysis care
                  </li>
                  <li
                    style="
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      margin-bottom: 12px;
                      color: #dc2626;
                    "
                  >
                    <i
                      class="fas fa-calendar-check"
                      style="width: 20px; text-align: center"
                    ></i>
                    You will receive confirmation with your Temanion's details
                  </li>
                  <li
                    style="
                      display: flex;
                      align-items: center;
                      gap: 12px;
                      color: #dc2626;
                    "
                  >
                    <i
                      class="fas fa-heartbeat"
                      style="width: 20px; text-align: center"
                    ></i>
                    Your companion will provide support for your dialysis
                    sessions
                  </li>
                </ul>
              </div>

              <!-- Fixed Terms & Conditions Checkbox -->
              <label class="terms-checkbox">
                <input type="checkbox" name="terms_agreed" required />
                <span class="checkmark"></span>
                <span class="terms-text">
                  I agree to the
                  <a href="terms.html" target="_blank">Terms & Conditions</a> and
                  <a href="privacy.html" target="_blank">Privacy Policy</a>
                </span>
              </label>

              <div class="form-actions">
                <button
                  type="button"
                  class="btn btn--outline btn--large"
                  onclick="prevStep()"
                >
                  <i class="fas fa-arrow-left"></i>
                  Previous
                </button>
                <button
                  type="button"
                  class="btn btn--success btn--large"
                  id="pay-deposit-btn"
                  onclick="proceedToPayment()"
                >
                  <i class="fas fa-credit-card"></i>
                  Pay Deposit & Confirm Booking
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- Success Modal -->
    <div id="booking-success-modal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <h2>Booking Request Submitted!</h2>
        <p>
          Thank you for choosing Teman Malaysia for your Dialysis Treatments
          support. We've received your booking request and will contact you
          within 24 hours to confirm the details.
        </p>
        <p>
          To complete your deposit payment, please proceed to our secure payment
          gateway:
          <a
            href="https://www.billplz.com/deposit4Teman"
            target="_blank"
            rel="noopener noreferrer"
            style="color: blue;"
          >
            Click here to make your payment
          </a>
        </p>

        <div class="booking-reference">
          <strong
            >Reference Number: <span id="booking-ref-number"></span
          ></strong>
        </div>
        <div class="modal-actions">
          <button
            class="btn btn--primary"
            onclick="window.location.href='booking.html'"
          >
            Book Another Service
          </button>
          <button class="btn btn--outline" onclick="closeModal()">Close</button>
        </div>
      </div>
    </div>

    <!-- Footer Component -->
    <div id="footer-placeholder"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
      // Current step tracking
      let currentStep = 1;
      const totalSteps = 3;

      // Update progress steps visual state
      function updateProgressSteps() {
        const steps = document.querySelectorAll(".step");

        steps.forEach((step, index) => {
          const stepNumber = index + 1;
          step.classList.remove("active", "completed");

          if (stepNumber < currentStep) {
            step.classList.add("completed");
          } else if (stepNumber === currentStep) {
            step.classList.add("active");
          }
        });
      }

      // Navigate to next step
      function nextStep() {
        if (currentStep < totalSteps) {
          if (validateCurrentStep()) {
            document
              .querySelector(`.form-step[data-step="${currentStep}"]`)
              .classList.remove("active");
            currentStep++;
            document
              .querySelector(`.form-step[data-step="${currentStep}"]`)
              .classList.add("active");
            updateProgressSteps();

            if (currentStep === 3) {
              updateBookingSummary();
            }

            window.scrollTo({ top: 0, behavior: "smooth" });
          }
        }
      }

      // Navigate to previous step
      function prevStep() {
        if (currentStep > 1) {
          document
            .querySelector(`.form-step[data-step="${currentStep}"]`)
            .classList.remove("active");
          currentStep--;
          document
            .querySelector(`.form-step[data-step="${currentStep}"]`)
            .classList.add("active");
          updateProgressSteps();
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      }

      // Enhanced validation function
      function validateCurrentStep() {
        clearValidationErrors();

        if (currentStep === 1) {
          // Validate package selection
          const packageSelected = document.querySelector(
            'input[name="package"]:checked'
          );
          if (!packageSelected) {
            showValidationError("Please select a package before continuing.");
            return false;
          }

          // Validate hours for hourly packages
          if (packageSelected.value === "hourly") {
            const hoursSelected = document.getElementById("hours").value;
            if (!hoursSelected) {
              showValidationError(
                "Please select the number of hours.",
                "hours"
              );
              return false;
            }
          }

          // Validate companion hours if companion addon is selected
          const companionAddon = document.querySelector(
            'input[name="companion_addon"]:checked'
          );
          if (companionAddon) {
            const companionHours =
              document.getElementById("companion-hours").value;
            if (!companionHours) {
              showValidationError(
                "Please select the companion duration.",
                "companion-hours"
              );
              return false;
            }
          }
        } else if (currentStep === 2) {
          // Required fields validation
          const requiredFields = [
            { name: "full_name", label: "Full Name" },
            { name: "phone", label: "Phone Number" },
            { name: "email", label: "Email Address" },
            { name: "emergency_contact", label: "Emergency Contact" },
            { name: "multi_dates", label: "Treatment Dates" },
            { name: "preferred_start_time", label: "Treatment Start Time" },
            { name: "center_address", label: "Dialysis Center Address" },
            { name: "pickup_address", label: "Pickup Address" },
            { name: "how_heard", label: "How did you hear about us?" },
            { name: "medical_conditions", label: "Related Medical Conditions" },
            { name: "dietary_restrictions", label: "Dietary Restrictions" },
            {
              name: "mobility_assistance",
              label: "Mobility Assistance Needed",
            },
            { name: "special_requirements", label: "Special Requirements" },
          ];

          for (let field of requiredFields) {
            const element = document.querySelector(`[name="${field.name}"]`);
            if (!element || !element.value.trim()) {
              showValidationError(
                `Please fill in the ${field.label} field.`,
                field.name
              );
              element.focus();
              return false;
            }
          }

          // Validate transportation mode
          const transportationSelected = document.querySelector(
            'input[name="transportation_mode"]:checked'
          );
          if (!transportationSelected) {
            showValidationError("Please select a transportation mode.");
            document.querySelector('input[name="transportation_mode"]').focus();
            return false;
          }

          // Validate email format
          const email = document.querySelector('[name="email"]').value;
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(email)) {
            showValidationError("Please enter a valid email address.", "email");
            return false;
          }
        } else if (currentStep === 3) {
          // Validate terms agreement
          const termsAgreed = document.querySelector(
            'input[name="terms_agreed"]:checked'
          );
          if (!termsAgreed) {
            showValidationError(
              "Please agree to the Terms & Conditions and Privacy Policy to continue."
            );
            return false;
          }
        }

        return true;
      }

      // Show validation error
      function showValidationError(message, fieldName = null) {
        alert(message);

        if (fieldName) {
          const field = document.querySelector(
            `[name="${fieldName}"], #${fieldName}`
          );
          if (field) {
            field.classList.add("error");
            field.focus();
          }
        }
      }

      // Clear validation errors
      function clearValidationErrors() {
        const errorFields = document.querySelectorAll(".error");
        errorFields.forEach((field) => field.classList.remove("error"));
      }

      // Enhanced booking summary update
      function updateBookingSummary() {
        // Package details
        const selectedPackage = document.querySelector(
          'input[name="package"]:checked'
        );
        let packageInfo = "";
        let estimatedCost = 0;

        if (selectedPackage) {
          if (selectedPackage.value === "hourly") {
            const hours = document.getElementById("hours").value;
            packageInfo = `Hourly Rate - ${hours} hours (RM${hours * 35})`;
            estimatedCost = hours * 35;
          } else if (selectedPackage.value === "package1") {
            packageInfo = "3-Session Package (6 hours total) - RM186";
            estimatedCost = 186;
          }
        }

        // Companion addon
        const companionAddon = document.querySelector(
          'input[name="companion_addon"]:checked'
        );
        let companionInfo = "None";
        if (companionAddon) {
          const companionHours =
            document.getElementById("companion-hours").value;
          if (companionHours) {
            const companionCost = companionHours * 30;
            companionInfo = `${companionHours} hours (+RM${companionCost})`;
            estimatedCost += companionCost;
          }
        }

        // Update summary fields
        document.getElementById("summary-package").textContent =
          packageInfo || "-";
        document.getElementById("summary-companion").textContent =
          companionInfo;
        document.getElementById(
          "summary-total"
        ).textContent = `RM ${estimatedCost}`;

        // Treatment details
        const treatmentDates = document.getElementById("multi-dates").value;
        document.getElementById("summary-dates").textContent =
          treatmentDates || "-";

        const startTime = document.getElementById("preferred-start-time").value;
        document.getElementById("summary-start-time").textContent =
          startTime || "-";

        // Transportation
        const transportation = document.querySelector(
          'input[name="transportation_mode"]:checked'
        );
        if (transportation) {
          const transportLabel =
            transportation.nextElementSibling.nextElementSibling.querySelector(
              "strong"
            ).textContent;
          document.getElementById("summary-transportation").textContent =
            transportLabel;
        }

        // Contact information
        document.getElementById("summary-name").textContent =
          document.getElementById("full-name").value || "-";
        document.getElementById("summary-phone").textContent =
          document.getElementById("phone").value || "-";
        document.getElementById("summary-email").textContent =
          document.getElementById("email").value || "-";
        document.getElementById("summary-emergency").textContent =
          document.getElementById("emergency-contact").value || "-";
        document.getElementById("summary-relationship").textContent =
          document.getElementById("relationship").value || "-";
        document.getElementById("summary-employer").textContent =
          document.getElementById("employer").value || "-";

        // Care recipient information
        document.getElementById("summary-patient-name").textContent =
          document.getElementById("patient-name").value ||
          "Same as contact person";
        document.getElementById("summary-patient-age").textContent =
          document.getElementById("patient-age").value
            ? document.getElementById("patient-age").value + " years"
            : "-";
        document.getElementById("summary-patient-gender").textContent =
          document.getElementById("patient-gender").value || "-";
        document.getElementById("summary-patient-language").textContent =
          document.getElementById("patient-language").value || "-";
        document.getElementById("summary-patient-weight").textContent =
          document.getElementById("patient-weight").value
            ? document.getElementById("patient-weight").value + " kg"
            : "-";
        document.getElementById("summary-patient-height").textContent =
          document.getElementById("patient-height").value
            ? document.getElementById("patient-height").value + " cm"
            : "-";

        // Location details
        document.getElementById("summary-center-address").textContent =
          document.getElementById("center-address").value || "-";
        document.getElementById("summary-pickup-address").textContent =
          document.getElementById("pickup-address").value || "-";
        document.getElementById("summary-return-address").textContent =
          document.getElementById("return-address").value ||
          "Same as pickup address";
        document.getElementById("summary-pickup-time").textContent =
          document.getElementById("pickup-time").value || "-";

        // Medical & care information
        document.getElementById("summary-medical-conditions").textContent =
          document.getElementById("medical-conditions").value ||
          "None specified";
        document.getElementById("summary-medications").textContent =
          document.getElementById("medications").value || "None specified";
        document.getElementById("summary-dietary").textContent =
          document.getElementById("dietary-restrictions").value ||
          "None specified";
        document.getElementById("summary-mobility").textContent =
          document.getElementById("mobility-assistance").value || "None";
        document.getElementById("summary-special-requirements").textContent =
          document.getElementById("special-requirements").value ||
          "None specified";

        // Companion preferences
        document.getElementById("summary-companion-gender").textContent =
          document.getElementById("companion-gender").value || "-";
        document.getElementById("summary-companion-language").textContent =
          document.getElementById("companion-language").value || "-";

        // Additional information
        document.getElementById("summary-treatment-schedule").textContent =
          document.getElementById("treatment-schedule").value ||
          "Not specified";
        document.getElementById("summary-additional-notes").textContent =
          document.getElementById("additional-notes").value || "None";
        document.getElementById("summary-how-heard").textContent =
          document.getElementById("how-heard").value || "-";
      }

      // Payment processing function

      function proceedToPayment() {
        // Validate terms agreement before proceeding
        const termsAgreed = document.querySelector(
          'input[name="terms_agreed"]:checked'
        );
        if (!termsAgreed) {
          alert(
            "Please agree to the Terms & Conditions and Privacy Policy before proceeding to payment."
          );
          return;
        }

        // Generate booking reference
        const refNumber = "TM" + Date.now().toString().slice(-6);

        // Show loading state
        const payButton = document.getElementById("pay-deposit-btn");
        const originalText = payButton.innerHTML;
        payButton.innerHTML =
          '<i class="fas fa-spinner fa-spin"></i> Submitting...';
        payButton.disabled = true;

        // Calculate estimated cost
        let estimatedCost = 0;
        const selectedPackage = document.querySelector(
          'input[name="package"]:checked'
        );
        if (selectedPackage) {
          if (selectedPackage.value === "hourly") {
            const hours = document.getElementById("hours").value;
            estimatedCost = hours * 35;
          } else if (selectedPackage.value === "package1") {
            estimatedCost = 186;
          }
        }
        const companionAddon = document.querySelector(
          'input[name="companion_addon"]:checked'
        );
        if (companionAddon) {
          const companionHours =
            document.getElementById("companion-hours").value;
          if (companionHours) {
            estimatedCost += companionHours * 30;
          }
        }

        // Prepare form data for Google Sheets
        const formData = new FormData();
        formData.append("booking_reference", refNumber);
        formData.append("service_type", "Dialysis Treatment Support");
        formData.append("estimated_cost", `RM ${estimatedCost}`);

        // Get all form fields
        const form = document.getElementById("dialysis-booking-form");
        const formElements = form.elements;

        for (let element of formElements) {
          if (element.name && element.value) {
            if (element.type === "checkbox" || element.type === "radio") {
              if (element.checked) {
                formData.append(element.name, element.value);
              }
            } else {
              formData.append(element.name, element.value);
            }
          }
        }

        // Convert FormData to URLSearchParams for Google Apps Script
        const params = new URLSearchParams();
        for (let [key, value] of formData.entries()) {
          params.append(key, value);
        }

        // Submit to Google Apps Script (replace with your actual deployment URL)
        const GOOGLE_SCRIPT_URL =
          "https://script.google.com/macros/s/AKfycbzqavkuXhUudYQJN1VwFTAX1YQHqmaBDMtVvhrAj5XZbMyJLysKDlnulaX6c8Lj33k/exec";

        fetch(GOOGLE_SCRIPT_URL, {
          method: "POST",
          body: params,
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              // Success - also submit to Formspree for email notification
              return fetch("https://formspree.io/f/xzzvjavz", {
                method: "POST",
                body: formData,
                headers: {
                  Accept: "application/json",
                },
              });
            } else {
              throw new Error(
                "Google Sheets submission failed: " + data.message
              );
            }
          })
          .then((response) => {
            if (response.ok) {
              // Both submissions successful
              document.getElementById("booking-ref-number").textContent =
                refNumber;
              document.getElementById("booking-success-modal").style.display =
                "flex";

              // Optional: Redirect to payment page
              setTimeout(() => {
                window.open("https://www.billplz.com/deposit4Teman", "_blank");
              }, 2000);
            } else {
              throw new Error("Formspree submission failed");
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert(
              "There was an error submitting your booking. Please try again or contact us directly."
            );
          })
          .finally(() => {
            // Reset button state
            payButton.innerHTML = originalText;
            payButton.disabled = false;
          });
      }

      // Flatpickr and date selection logic
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(today.getDate() + 1);
      const dayAfterTomorrow = new Date(today);
      dayAfterTomorrow.setDate(today.getDate() + 2);

      function formatDate(date) {
        return date.toISOString().split("T")[0];
      }

      const minDateStr = formatDate(dayAfterTomorrow);
      const messageEl = document.getElementById("date-limit-message");
      const countEl = document.getElementById("selected-count");
      const maxDatesEl = document.getElementById("max-dates");
      const hoursInfoEl = document.getElementById("hours-info");
      const multiDatesInput = document.getElementById("multi-dates");

      let fp = null;
      let maxAllowedSessions = 0;

      function calculateMaxSessions() {
        const selectedPackage = document.querySelector(
          'input[name="package"]:checked'
        );

        if (!selectedPackage) {
          maxAllowedSessions = 0;
          maxDatesEl.textContent = "0";
          hoursInfoEl.textContent =
            "Please select a package first to enable date selection";
          hoursInfoEl.style.color = "#ef4444";
          multiDatesInput.disabled = true;
          if (fp) fp.set("disabled", true);
          return;
        }

        let totalHours = 0;

        if (selectedPackage.value === "hourly") {
          const hoursSelect = document.getElementById("hours");
          if (hoursSelect.value) {
            totalHours = parseInt(hoursSelect.value) || 0;
          }
        } else if (selectedPackage.value === "package1") {
          totalHours = 6;
        }

        if (totalHours > 0) {
          maxAllowedSessions = Math.floor(totalHours / 2);
          if (totalHours % 2 === 1) {
            maxAllowedSessions += 1;
          }

          maxDatesEl.textContent = maxAllowedSessions;

          if (selectedPackage.value === "package1") {
            hoursInfoEl.textContent = `Package includes 6 hours total - you can select up to ${maxAllowedSessions} treatment sessions`;
          } else {
            hoursInfoEl.textContent = `Based on ${totalHours} hours selected - you can select up to ${maxAllowedSessions} sessions`;
          }
          hoursInfoEl.style.color = "#10b981";

          multiDatesInput.disabled = false;
          if (fp) {
            fp.set("disabled", false);
            if (fp.selectedDates.length > maxAllowedSessions) {
              fp.clear();
            }
          }
        } else {
          maxAllowedSessions = 0;
          maxDatesEl.textContent = "0";
          hoursInfoEl.textContent =
            "Please select hours to enable date selection";
          hoursInfoEl.style.color = "#ef4444";
          multiDatesInput.disabled = true;
          if (fp) fp.set("disabled", true);
        }

        updateDateSelection(fp ? fp.selectedDates : [], fp);
      }

      function initializeFlatpickr() {
        fp = flatpickr("#multi-dates", {
          mode: "multiple",
          dateFormat: "Y-m-d",
          disable: [formatDate(today), formatDate(tomorrow)],
          minDate: minDateStr,
          disabled: true,
          onChange: function (selectedDates, dateStr, instance) {
            updateDateSelection(selectedDates, instance);
          },
          onReady: function (selectedDates, dateStr, instance) {
            updateDateSelection(selectedDates, instance);
          },
        });
      }

      function updateDateSelection(selectedDates, instance) {
        if (!instance) return;

        const count = selectedDates.length;
        countEl.textContent = count;

        if (count < maxAllowedSessions && maxAllowedSessions > 0) {
          messageEl.style.display = "block";
        } else {
          messageEl.style.display = "none";
        }

        if (count >= maxAllowedSessions && maxAllowedSessions > 0) {
          const calendar = instance.calendarContainer;
          if (calendar) {
            const unselectedDays = calendar.querySelectorAll(
              ".flatpickr-day:not(.selected):not(.flatpickr-disabled)"
            );
            unselectedDays.forEach((day) => {
              day.style.opacity = "0.3";
              day.style.pointerEvents = "none";
            });
          }
        } else {
          const calendar = instance.calendarContainer;
          if (calendar) {
            const unselectedDays = calendar.querySelectorAll(
              ".flatpickr-day:not(.selected):not(.flatpickr-disabled)"
            );
            unselectedDays.forEach((day) => {
              day.style.opacity = "";
              day.style.pointerEvents = "";
            });
          }
        }
      }

      // Close modal function
      function closeModal() {
        document.getElementById("booking-success-modal").style.display = "none";
      }

      // Event listeners
      document.addEventListener("DOMContentLoaded", function () {
        initializeFlatpickr();
        calculateMaxSessions();
        updateProgressSteps();

        // Package and hours change listeners
        document.addEventListener("change", function (e) {
          if (e.target.name === "package" || e.target.id === "hours") {
            calculateMaxSessions();
          }

          // Show/hide hours selection for different packages
          if (e.target.name === "package") {
            const hoursSelections =
              document.querySelectorAll(".hours-selection");
            hoursSelections.forEach((selection) => {
              selection.style.display = "none";
            });

            if (e.target.value === "hourly") {
              document.querySelector(
                "#hourly-package + .package-card .hours-selection"
              ).style.display = "block";
            }
          }

          // Show/hide companion hours selection
          if (e.target.name === "companion_addon") {
            const companionHoursSelection = document.querySelector(
              "#companion-addon + .package-card .hours-selection"
            );
            if (e.target.checked) {
              companionHoursSelection.style.display = "block";
            } else {
              companionHoursSelection.style.display = "none";
            }
          }
        });
      });

      // Load header and footer components
      async function loadComponents() {
        try {
          const headerResponse = await fetch("../components/header.html");
          if (headerResponse.ok) {
            const headerHTML = await headerResponse.text();
            document.getElementById("header-placeholder").innerHTML =
              headerHTML;

            setTimeout(() => {
              const bookingLink = document.querySelector(
                'a[href="booking.html"]'
              );
              if (bookingLink) {
                bookingLink.classList.add("active");
              }
              initializeNavigation();
            }, 100);
          }

          const footerResponse = await fetch("../components/footer.html");
          if (footerResponse.ok) {
            const footerHTML = await footerResponse.text();
            document.getElementById("footer-placeholder").innerHTML =
              footerHTML;
          }

          initializeMainJS();
        } catch (error) {
          console.error("Error loading components:", error);
        }
      }

      function initializeNavigation() {
        const navToggle = document.getElementById("nav-toggle");
        const navMenu = document.getElementById("nav-menu");

        if (navToggle && navMenu) {
          navToggle.addEventListener("click", () => {
            navMenu.classList.toggle("show");
            const icon = navToggle.querySelector("i");
            if (navMenu.classList.contains("show")) {
              icon.className = "fas fa-times";
            } else {
              icon.className = "fas fa-bars";
            }
          });

          document.querySelectorAll(".nav__link").forEach((link) => {
            link.addEventListener("click", () => {
              navMenu.classList.remove("show");
              const icon = navToggle.querySelector("i");
              if (icon) icon.className = "fas fa-bars";
            });
          });

          document.addEventListener("click", (e) => {
            if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
              navMenu.classList.remove("show");
              const icon = navToggle.querySelector("i");
              if (icon) icon.className = "fas fa-bars";
            }
          });
        }

        window.addEventListener("scroll", () => {
          const header = document.getElementById("header");
          if (header) {
            if (window.scrollY > 100) {
              header.style.background = "rgba(255, 255, 255, 0.98)";
              header.style.boxShadow = "0 2px 20px rgba(0, 0, 0, 0.1)";
            } else {
              header.style.background = "rgba(255, 255, 255, 0.95)";
              header.style.boxShadow = "none";
            }
          }
        });
      }

      function initializeMainJS() {
        console.log(
          "Teman Malaysia dialysis treatment booking loaded successfully!"
        );
      }

      document.addEventListener("DOMContentLoaded", function () {
        loadComponents();
      });
    </script>
    <script src="../assets/js/main.js"></script>
  </body>
</html>
